import{c as J,r as k,j as e,X as Z,u as W,d as q,g as ie,T as oe,W as X,D as V,e as K,b as Y,S as ee}from"./index-DPf7JDXQ.js";import{f as _}from"./dateFormatter-DEoQwZ0j.js";import{M as G}from"./Modal-CEl-WYAK.js";import{S as B}from"./StatCard-DODbRGRV.js";import{T as L}from"./trending-up-CwnZmgTI.js";import{T as re}from"./trending-down-CmmKGqIM.js";import{S as ce}from"./search-CdjOYRHj.js";import{F as de}from"./file-text-DjujcPnM.js";import{U as te}from"./users-DVKgvr1L.js";/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]],se=J("building-2",me);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],ne=J("pen",ue);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=[["path",{d:"M11 17h3v2a1 1 0 0 0 1 1h2a1 1 0 0 0 1-1v-3a3.16 3.16 0 0 0 2-2h1a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1h-1a5 5 0 0 0-2-4V3a4 4 0 0 0-3.2 1.6l-.3.4H11a6 6 0 0 0-6 6v1a5 5 0 0 0 2 4v3a1 1 0 0 0 1 1h2a1 1 0 0 0 1-1z",key:"1piglc"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M2 8v1a2 2 0 0 0 2 2h1",key:"1env43"}]],he=J("piggy-bank",xe);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],ae=J("user",pe);function be({expectedBalance:l,onReconcile:g,onClose:I}){const[w,v]=k.useState(l.toString()),[N,c]=k.useState(""),s=2e3,o=parseFloat(w||0)-l,n=Math.max(0,parseFloat(w||0)-s),C=p=>{p.preventDefault(),g({actualCount:parseFloat(w),availableForDistribution:n,reservedAmount:s,notes:N.trim()})},b=p=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(p||0);return e.jsx(G,{isOpen:!0,onClose:I,size:"medium",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Daily Cash Reconciliation"}),e.jsx("button",{onClick:I,className:"text-gray-400 hover:text-gray-600",children:e.jsx(Z,{className:"h-6 w-6"})})]}),e.jsxs("form",{onSubmit:C,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Expected Balance"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:b(l)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Actual Count *"}),e.jsx("input",{type:"number",value:w,onChange:p=>v(p.target.value),step:"0.01",required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md"})]}),o!==0&&e.jsx("div",{className:`p-3 rounded ${o>0?"bg-green-50":"bg-red-50"}`,children:e.jsxs("p",{className:"text-sm font-medium",children:["Discrepancy: ",b(o)]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes"}),e.jsx("textarea",{value:N,onChange:p=>c(p.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md",placeholder:"Add any notes about the reconciliation..."})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:I,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700",children:"Reconcile"})]})]})]})})}function ge({currentCashPosition:l,openingBalance:g}){const{sales:I,expenses:w,withdrawals:v,cashInjections:N=[],cashFlows:c,addCashFlow:s}=W(),{showSuccessMessage:o,showErrorMessage:n}=q(),[C,b]=k.useState(!1),p=new Date().toISOString().split("T")[0],j=I.filter(a=>a.date<p).reduce((a,F)=>a+(F.totalAmount||0),0),d=N.filter(a=>a.date<p).reduce((a,F)=>a+F.amount,0),y=w.filter(a=>a.date<p).reduce((a,F)=>a+F.amount,0),u=v.filter(a=>a.date<p).reduce((a,F)=>a+F.amount,0),m=j+d-y-u,D=I.filter(a=>a.date===p),t=w.filter(a=>a.date===p),i=v.filter(a=>a.date===p),r=N.filter(a=>a.date===p),f=D.reduce((a,F)=>a+(F.totalAmount||0),0),A=r.reduce((a,F)=>a+(F.amount||0),0),O=f+A,E=t.reduce((a,F)=>a+F.amount,0),M=i.reduce((a,F)=>a+F.amount,0),U=E+M,T=O-U,R=m+T,h=c.find(a=>a.date===p),S=h?.reconciled===!0,P=a=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(a||0),le=async a=>{try{await s({date:p,openingBalance:m,cashSales:O,cashExpenses:E,withdrawals:i.map(F=>F.id),theoreticalBalance:R,actualCount:a.actualCount,actualBalance:a.actualCount,discrepancy:a.actualCount-R,availableForDistribution:a.availableForDistribution,reservedAmount:a.reservedAmount,notes:a.notes,reconciled:!0,reconciledBy:"Current User",reconciledAt:new Date().toISOString()}),o("Cash Reconciled","Daily cash flow has been reconciled successfully"),b(!1)}catch(F){n("Reconciliation Failed",F.message)}};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Today's Cash Flow"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:new Date().toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]}),!S&&e.jsx("button",{onClick:()=>b(!0),className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700",children:"Reconcile Cash"})]}),S?e.jsxs("div",{className:"mb-6 bg-green-50 border border-green-200 rounded-lg p-4 flex items-center",children:[e.jsx(ie,{className:"h-5 w-5 text-green-600 mr-3"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-900",children:"Cash Reconciled"}),e.jsxs("p",{className:"text-sm text-green-700",children:["Today's cash has been reconciled. Actual: ",P(h.actualCount)," | Discrepancy: ",P(h.discrepancy)]})]})]}):e.jsxs("div",{className:"mb-6 bg-yellow-50 border border-yellow-200 rounded-lg p-4 flex items-center",children:[e.jsx(oe,{className:"h-5 w-5 text-yellow-600 mr-3"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-yellow-900",children:"Pending Reconciliation"}),e.jsx("p",{className:"text-sm text-yellow-700",children:"Please reconcile today's cash before closing"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[e.jsx(B,{title:"Opening Balance",value:P(m),subtitle:"Balance at start of today",icon:X,iconBgColor:"bg-gray-100",iconColor:"text-gray-600"}),e.jsx(B,{title:"Cash Inflows",value:`+${P(O)}`,subtitle:`Sales: ${P(f)} • Injections: ${P(A)}`,icon:L,iconBgColor:"bg-green-100",iconColor:"text-green-600",trend:O>0?"up":null}),e.jsx(B,{title:"Cash Outflows",value:`-${P(U)}`,subtitle:`Expenses: ${P(E)} • Withdrawals: ${P(M)}`,icon:re,iconBgColor:"bg-red-100",iconColor:"text-red-600",trend:U>0?"down":null}),e.jsx(B,{title:"Expected Balance",value:P(R),subtitle:`Net: ${T>=0?"+":""}${P(T)}`,icon:V,iconBgColor:"bg-blue-100",iconColor:"text-blue-600",trend:T>0?"up":T<0?"down":null})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200",children:[e.jsx("div",{className:"px-4 py-3 border-b border-gray-200",children:e.jsx("h4",{className:"text-sm font-medium text-gray-900",children:"Cash Inflows by Date"})}),e.jsx("div",{className:"p-4",children:(()=>{const a={};I.forEach(x=>{a[x.date]||(a[x.date]={sales:0,injections:0,count:0}),a[x.date].sales+=x.totalAmount||0,a[x.date].count+=1}),N.forEach(x=>{a[x.date]||(a[x.date]={sales:0,injections:0,count:0}),a[x.date].injections+=x.amount||0,a[x.date].count+=1});const z=Object.keys(a).sort((x,$)=>$.localeCompare(x)).slice(0,10);return z.length===0?e.jsx("p",{className:"text-sm text-gray-500",children:"No cash inflows recorded"}):e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto custom-scrollbar",children:z.map(x=>{const $=a[x],Q=$.sales+$.injections,H=x===p;return e.jsxs("div",{className:`flex justify-between items-center ${H?"bg-blue-50 p-2 rounded":""}`,children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium text-gray-900",children:[_(x)," ",H&&e.jsx("span",{className:"text-xs text-blue-600 ml-1",children:"(Today)"})]}),e.jsxs("p",{className:"text-xs text-gray-500",children:[$.count," transaction",$.count!==1?"s":"",$.sales>0&&` • Sales: ${P($.sales)}`,$.injections>0&&` • Injections: ${P($.injections)}`]})]}),e.jsxs("span",{className:"text-sm font-medium text-green-600",children:["+",P(Q)]})]},x)})})})()})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200",children:[e.jsx("div",{className:"px-4 py-3 border-b border-gray-200",children:e.jsx("h4",{className:"text-sm font-medium text-gray-900",children:"Cash Outflows by Date"})}),e.jsx("div",{className:"p-4",children:(()=>{const a={};w.forEach(x=>{a[x.date]||(a[x.date]={expenses:0,withdrawals:0,count:0}),a[x.date].expenses+=x.amount||0,a[x.date].count+=1}),v.forEach(x=>{a[x.date]||(a[x.date]={expenses:0,withdrawals:0,count:0}),a[x.date].withdrawals+=x.amount||0,a[x.date].count+=1});const z=Object.keys(a).sort((x,$)=>$.localeCompare(x)).slice(0,10);return z.length===0?e.jsx("p",{className:"text-sm text-gray-500",children:"No cash outflows recorded"}):e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto custom-scrollbar",children:z.map(x=>{const $=a[x],Q=$.expenses+$.withdrawals,H=x===p;return e.jsxs("div",{className:`flex justify-between items-center ${H?"bg-red-50 p-2 rounded":""}`,children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium text-gray-900",children:[_(x)," ",H&&e.jsx("span",{className:"text-xs text-red-600 ml-1",children:"(Today)"})]}),e.jsxs("p",{className:"text-xs text-gray-500",children:[$.count," transaction",$.count!==1?"s":"",$.expenses>0&&` • Expenses: ${P($.expenses)}`,$.withdrawals>0&&` • Withdrawals: ${P($.withdrawals)}`]})]}),e.jsxs("span",{className:"text-sm font-medium text-red-600",children:["-",P(Q)]})]},x)})})})()})]})]}),C&&e.jsx(be,{expectedBalance:R,onReconcile:le,onClose:()=>b(!1)})]})}function fe({availableCash:l,onClose:g}){const{partners:I,addWithdrawal:w}=W(),{showSuccessMessage:v,showErrorMessage:N}=q(),[c,s]=k.useState({partnerId:"",amount:"",type:"personal",purpose:"",notes:"",date:new Date().toISOString().split("T")[0],time:new Date().toTimeString().split(" ")[0].substring(0,5)}),[o,n]=k.useState({}),[C,b]=k.useState(!1),p=[{value:"personal",label:"Personal Draw"},{value:"business_expense",label:"Business Expense"},{value:"profit_distribution",label:"Profit Distribution"},{value:"loan",label:"Loan"}],j=async d=>{d.preventDefault();const y={};if(c.partnerId||(y.partnerId="Please select a partner"),!c.amount||parseFloat(c.amount)<=0?y.amount="Amount must be greater than 0":parseFloat(c.amount)>l&&(y.amount=`Cannot exceed available cash (${l.toFixed(2)})`),c.purpose||(y.purpose="Purpose is required"),Object.keys(y).length>0){n(y);return}b(!0);try{const u=I.find(m=>m.id===c.partnerId);await w({partnerId:c.partnerId,partnerName:u?.name||"Unknown",amount:parseFloat(c.amount),type:c.type,purpose:c.purpose,notes:c.notes,date:c.date,time:c.time}),v("Withdrawal Recorded","The withdrawal has been recorded successfully"),g()}catch(u){N("Operation Failed",u.message)}finally{b(!1)}};return e.jsx(G,{isOpen:!0,onClose:g,size:"medium",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Record Withdrawal"}),e.jsx("button",{onClick:g,className:"text-gray-400 hover:text-gray-600",children:e.jsx(Z,{className:"h-6 w-6"})})]}),e.jsxs("form",{onSubmit:j,className:"p-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Partner *"}),e.jsxs("select",{value:c.partnerId,onChange:d=>s({...c,partnerId:d.target.value}),className:`w-full px-3 py-2 border rounded-md ${o.partnerId?"border-red-300":"border-gray-300"}`,children:[e.jsx("option",{value:"",children:"Select partner..."}),I.map(d=>e.jsxs("option",{value:d.id,children:[d.name," (",d.ownershipPercent,"%)"]},d.id))]}),o.partnerId&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:o.partnerId})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Amount ($) *"}),e.jsx("input",{type:"number",value:c.amount,onChange:d=>s({...c,amount:d.target.value}),step:"0.01",min:"0",className:`w-full px-3 py-2 border rounded-md ${o.amount?"border-red-300":"border-gray-300"}`}),o.amount&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:o.amount}),e.jsxs("p",{className:"mt-1 text-xs text-gray-500",children:["Available: $",l.toFixed(2)]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Type *"}),e.jsx("select",{value:c.type,onChange:d=>s({...c,type:d.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md",children:p.map(d=>e.jsx("option",{value:d.value,children:d.label},d.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Purpose *"}),e.jsx("input",{type:"text",value:c.purpose,onChange:d=>s({...c,purpose:d.target.value}),className:`w-full px-3 py-2 border rounded-md ${o.purpose?"border-red-300":"border-gray-300"}`}),o.purpose&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:o.purpose})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes"}),e.jsx("textarea",{value:c.notes,onChange:d=>s({...c,notes:d.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md"})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:g,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:C,className:"px-4 py-2 text-sm font-medium text-white bg-green-600 rounded-md hover:bg-green-700 disabled:opacity-50",children:C?"Recording...":"Record Withdrawal"})]})]})]})})}function ye({availableCash:l}){const{partners:g,withdrawals:I,deleteWithdrawal:w}=W(),{showConfirmDialog:v,showSuccessMessage:N,showErrorMessage:c}=q(),[s,o]=k.useState(!1),[n,C]=k.useState(""),[b,p]=k.useState(""),[j,d]=k.useState(""),y=I.filter(t=>{const i=!n||t.purpose?.toLowerCase().includes(n.toLowerCase())||t.notes?.toLowerCase().includes(n.toLowerCase()),r=!b||t.partnerId===b,f=!j||t.type===j;return i&&r&&f}).sort((t,i)=>new Date(i.date)-new Date(t.date)),u=async t=>{if(await v("Delete Withdrawal",`Are you sure you want to delete this $${t.amount} withdrawal? This will update the partner's capital account.`,"danger"))try{await w(t.id),N("Withdrawal Deleted","The withdrawal has been removed and capital account updated")}catch(r){c("Delete Failed",r.message)}},m=t=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(t||0),D=y.reduce((t,i)=>t+i.amount,0);return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Withdrawal History"}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[y.length," withdrawals • ",m(D)," total"]})]}),e.jsxs("button",{onClick:()=>o(!0),disabled:g.length===0||l<=0,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),"Record Withdrawal"]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mb-6",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(ce,{className:"h-5 w-5 absolute left-3 top-3 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search withdrawals...",value:n,onChange:t=>C(t.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md"})]})}),e.jsxs("select",{value:b,onChange:t=>p(t.target.value),className:"px-3 py-2 border border-gray-300 rounded-md",children:[e.jsx("option",{value:"",children:"All Partners"}),g.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),e.jsxs("select",{value:j,onChange:t=>d(t.target.value),className:"px-3 py-2 border border-gray-300 rounded-md",children:[e.jsx("option",{value:"",children:"All Types"}),e.jsx("option",{value:"personal",children:"Personal Draw"}),e.jsx("option",{value:"business_expense",children:"Business Expense"}),e.jsx("option",{value:"profit_distribution",children:"Profit Distribution"}),e.jsx("option",{value:"loan",children:"Loan"})]})]}),y.length===0?e.jsx("div",{className:"text-center py-12 bg-white rounded-lg border border-gray-200",children:e.jsx("p",{className:"text-gray-500",children:"No withdrawals found"})}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Partner"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Amount"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Type"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Purpose"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:y.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:_(t.date)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:t.partnerName}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:m(t.amount)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-blue-100 text-blue-800",children:t.type?.replace("_"," ")})}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-900",children:t.purpose}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:e.jsx("button",{onClick:()=>u(t),className:"text-red-600 hover:text-red-900",children:e.jsx(Y,{className:"h-4 w-4"})})})]},t.id))})]})}),s&&e.jsx(fe,{availableCash:l,onClose:()=>o(!1)})]})}function je({partner:l,onClose:g}){const{partners:I,addPartner:w,updatePartner:v}=W(),{showSuccessMessage:N,showErrorMessage:c}=q(),[s,o]=k.useState({name:l?.name||"",email:l?.email||"",phoneNumber:l?.phoneNumber||"",ownershipPercent:l?.ownershipPercent?.toString()||"",initialInvestment:l?.capitalAccount?.initialInvestment?.toString()||"0",bankDetails:{accountName:l?.bankDetails?.accountName||"",accountNumber:l?.bankDetails?.accountNumber||"",bankName:l?.bankDetails?.bankName||""}}),[n,C]=k.useState({}),[b,p]=k.useState(!1),j=u=>{const{name:m,value:D}=u.target;if(m.startsWith("bank_")){const t=m.replace("bank_","");o(i=>({...i,bankDetails:{...i.bankDetails,[t]:D}}))}else o(t=>({...t,[m]:D}));n[m]&&C(t=>{const i={...t};return delete i[m],i})},d=()=>{const u={};if(s.name.trim()||(u.name="Partner name is required"),!s.ownershipPercent)u.ownershipPercent="Ownership percentage is required";else{const m=parseFloat(s.ownershipPercent);(m<=0||m>100)&&(u.ownershipPercent="Must be between 0 and 100");const D=I.filter(t=>t.id!==l?.id).reduce((t,i)=>t+(i.ownershipPercent||0),0);D+m>100&&(u.ownershipPercent=`Total ownership would exceed 100% (current: ${D}%)`)}return s.email&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s.email)&&(u.email="Invalid email format"),s.initialInvestment&&parseFloat(s.initialInvestment)<0&&(u.initialInvestment="Investment cannot be negative"),C(u),Object.keys(u).length===0},y=async u=>{if(u.preventDefault(),!!d()){p(!0);try{const m={name:s.name.trim(),email:s.email.trim(),phoneNumber:s.phoneNumber.trim(),ownershipPercent:parseFloat(s.ownershipPercent),initialInvestment:parseFloat(s.initialInvestment||0),bankDetails:{accountName:s.bankDetails.accountName.trim(),accountNumber:s.bankDetails.accountNumber.trim(),bankName:s.bankDetails.bankName.trim()}};l?(await v(l.id,m),N("Partner Updated",`${m.name}'s information has been updated`)):(await w(m),N("Partner Added",`${m.name} has been added successfully`)),g()}catch(m){console.error("Partner form submission error:",m),c("Operation Failed",m.message||"Failed to save partner")}finally{p(!1)}}};return e.jsx(G,{isOpen:!0,onClose:g,size:"medium",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:l?"Edit Partner":"Add New Partner"}),e.jsx("button",{onClick:g,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(Z,{className:"h-6 w-6"})})]}),e.jsxs("form",{onSubmit:y,className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-4",children:"Basic Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 mb-1",children:"Full Name *"}),e.jsx("input",{type:"text",id:"name",name:"name",value:s.name,onChange:j,className:`w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 ${n.name?"border-red-300":"border-gray-300"}`,placeholder:"Partner name"}),n.name&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:n.name})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"ownershipPercent",className:"block text-sm font-medium text-gray-700 mb-1",children:"Ownership (%) *"}),e.jsx("input",{type:"number",id:"ownershipPercent",name:"ownershipPercent",value:s.ownershipPercent,onChange:j,min:"0",max:"100",step:"0.01",className:`w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 ${n.ownershipPercent?"border-red-300":"border-gray-300"}`,placeholder:"50"}),n.ownershipPercent&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:n.ownershipPercent})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-4",children:"Contact Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:"Email Address"}),e.jsx("input",{type:"email",id:"email",name:"email",value:s.email,onChange:j,className:`w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 ${n.email?"border-red-300":"border-gray-300"}`,placeholder:"Email address"}),n.email&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:n.email})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"phoneNumber",className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone Number"}),e.jsx("input",{type:"tel",id:"phoneNumber",name:"phoneNumber",value:s.phoneNumber,onChange:j,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Phone number"})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-4",children:"Financial Information"}),e.jsx("div",{className:"grid grid-cols-1 gap-4",children:e.jsxs("div",{children:[e.jsx("label",{htmlFor:"initialInvestment",className:"block text-sm font-medium text-gray-700 mb-1",children:"Initial Investment ($)"}),e.jsx("input",{type:"number",id:"initialInvestment",name:"initialInvestment",value:s.initialInvestment,onChange:j,min:"0",step:"0.01",className:`w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 ${n.initialInvestment?"border-red-300":"border-gray-300"}`,placeholder:"Initial investment"}),n.initialInvestment&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:n.initialInvestment})]})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-4",children:"Bank Details (Optional)"}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"bank_accountName",className:"block text-sm font-medium text-gray-700 mb-1",children:"Account Name"}),e.jsx("input",{type:"text",id:"bank_accountName",name:"bank_accountName",value:s.bankDetails.accountName,onChange:j,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Partner name"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"bank_bankName",className:"block text-sm font-medium text-gray-700 mb-1",children:"Bank Name"}),e.jsx("input",{type:"text",id:"bank_bankName",name:"bank_bankName",value:s.bankDetails.bankName,onChange:j,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Bank name"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"bank_accountNumber",className:"block text-sm font-medium text-gray-700 mb-1",children:"Account Number"}),e.jsx("input",{type:"text",id:"bank_accountNumber",name:"bank_accountNumber",value:s.bankDetails.accountNumber,onChange:j,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Account number"})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:g,disabled:b,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:b,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:b?"Saving...":l?"Update Partner":"Add Partner"})]})]})]})})}function Ne({partner:l,onClose:g}){const{withdrawals:I}=W(),w=I.filter(o=>o.partnerId===l.id).sort((o,n)=>new Date(n.date)-new Date(o.date)),v=l.capitalAccount||{},N=w.reduce((o,n)=>o+n.amount,0),c=(v.initialInvestment||0)+(v.profitShare||0)-N,s=o=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(o||0);return e.jsx(G,{isOpen:!0,onClose:g,size:"large",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-gray-200",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:l.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[l.ownershipPercent,"% Partner"]})]}),e.jsx("button",{onClick:g,className:"text-gray-400 hover:text-gray-600",children:e.jsx(Z,{className:"h-6 w-6"})})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h4",{className:"text-base font-medium text-gray-900 mb-4",children:"Capital Account"}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Initial Investment"}),e.jsx("span",{className:"text-sm font-medium",children:s(v.initialInvestment||0)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Profit Share"}),e.jsx("span",{className:"text-sm font-medium",children:s(v.profitShare||0)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Total Withdrawn"}),e.jsxs("span",{className:"text-sm font-medium text-red-600",children:["-",s(N)]})]}),e.jsxs("div",{className:"flex justify-between pt-2 border-t border-gray-200",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",children:"Current Equity"}),e.jsx("span",{className:`text-base font-semibold ${c>=0?"text-green-600":"text-red-600"}`,children:s(c)})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-base font-medium text-gray-900 mb-4",children:"Recent Withdrawals"}),w.length===0?e.jsx("p",{className:"text-sm text-gray-500",children:"No withdrawals recorded"}):e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:w.slice(0,10).map(o=>e.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 rounded",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:s(o.amount)}),e.jsxs("p",{className:"text-xs text-gray-500",children:[o.type," - ",o.purpose]})]}),e.jsx("span",{className:"text-sm text-gray-600",children:_(o.date)})]},o.id))})]})]})]})})}function we(){const{partners:l,withdrawals:g,deletePartner:I}=W(),{showConfirmDialog:w,showSuccessMessage:v,showErrorMessage:N}=q(),[c,s]=k.useState(!1),[o,n]=k.useState(null),[C,b]=k.useState(null),p=()=>{n(null),s(!0)},j=t=>{n(t),s(!0)},d=t=>{b(t)},y=async t=>{const i=g.filter(f=>f.partnerId===t.id);if(i.length>0){N("Cannot Delete Partner",`${t.name} has ${i.length} withdrawal records. Archive partner instead.`);return}if(await w("Delete Partner",`Are you sure you want to delete ${t.name}? This action cannot be undone.`,"danger"))try{await I(t.id),v("Partner Deleted",`${t.name} has been removed`)}catch(f){N("Delete Failed",f.message)}},u=t=>{const i=g.filter(E=>E.partnerId===t.id),r=i.reduce((E,M)=>E+M.amount,0),f=i.sort((E,M)=>new Date(M.date)-new Date(E.date))[0],A=t.capitalAccount||{},O=(A.initialInvestment||0)+(A.profitShare||0)-r;return{totalWithdrawn:r,lastWithdrawal:f,currentEquity:O,withdrawalCount:i.length}},m=t=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(t||0),D=t=>t?_(t):"Never";return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Partners"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Manage partner profiles and equity accounts"})]}),e.jsxs("button",{onClick:p,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),"Add Partner"]})]}),l.length===0?e.jsxs("div",{className:"text-center py-12 bg-white rounded-lg border-2 border-dashed border-gray-300",children:[e.jsx(ae,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No Partners"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"No partners added."})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:l.map(t=>{const i=u(t),r=i.currentEquity>=0;return e.jsx("div",{className:"bg-white rounded-lg shadow hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-12 w-12 rounded-full bg-blue-100 flex items-center justify-center",children:e.jsx(ae,{className:"h-6 w-6 text-blue-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("h4",{className:"text-lg font-medium text-gray-900",children:t.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[t.ownershipPercent,"% ownership"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("button",{onClick:()=>d(t),className:"text-blue-600 hover:text-blue-800 p-1",title:"View details",children:e.jsx(L,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>j(t),className:"text-gray-600 hover:text-gray-800 p-1",title:"Edit partner",children:e.jsx(ne,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>y(t),className:"text-red-600 hover:text-red-800 p-1",title:"Delete partner",children:e.jsx(Y,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Current Equity"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:`text-lg font-semibold ${r?"text-green-600":"text-red-600"}`,children:m(i.currentEquity)}),r?e.jsx(L,{className:"h-4 w-4 text-green-600 ml-1"}):e.jsx(re,{className:"h-4 w-4 text-red-600 ml-1"})]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Initial Investment"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:m(t.capitalAccount?.initialInvestment||0)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Total Withdrawn"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:m(i.totalWithdrawn)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Last Withdrawal"}),e.jsx("span",{className:"text-sm text-gray-500",children:D(i.lastWithdrawal?.date)})]})]}),(t.email||t.phoneNumber)&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200",children:[t.email&&e.jsxs("p",{className:"text-sm text-gray-600 truncate",children:["📧 ",t.email]}),t.phoneNumber&&e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["📱 ",t.phoneNumber]})]})]})},t.id)})}),c&&e.jsx(je,{partner:o,onClose:()=>{s(!1),n(null)}}),C&&e.jsx(Ne,{partner:C,onClose:()=>b(null)})]})}function ve({injection:l,onClose:g}){const{partners:I,addCashInjection:w,updateCashInjection:v}=W(),{showSuccessMessage:N,showErrorMessage:c}=q(),[s,o]=k.useState({type:l?.type||"Capital Contribution",amount:l?.amount?.toString()||"",date:l?.date||new Date().toISOString().split("T")[0],source:l?.source||"",description:l?.description||"",reference:l?.reference||"",partnerId:l?.partnerId||"",notes:l?.notes||""}),[n,C]=k.useState({}),[b,p]=k.useState(!1),j=[{value:"Capital Contribution",label:"Capital Contribution",requiresPartner:!0},{value:"Loan",label:"Loan/Financing",requiresPartner:!1},{value:"Other Income",label:"Other Income",requiresPartner:!1},{value:"Opening Balance",label:"Opening Balance Adjustment",requiresPartner:!1}],d=j.find(t=>t.value===s.type),y=t=>{const{name:i,value:r}=t.target;o(f=>({...f,[i]:r})),n[i]&&C(f=>({...f,[i]:""})),i==="type"&&(j.find(A=>A.value===r)?.requiresPartner||o(A=>({...A,partnerId:""})))},u=()=>{const t={};return s.type||(t.type="Please select an injection type"),s.amount?parseFloat(s.amount)<=0&&(t.amount="Amount must be greater than 0"):t.amount="Amount is required",s.date||(t.date="Date is required"),s.source.trim()||(t.source="Source is required"),d?.requiresPartner&&!s.partnerId&&(t.partnerId="Please select a partner for capital contribution"),s.description.trim()||(t.description="Description is required"),C(t),Object.keys(t).length===0},m=async t=>{if(t.preventDefault(),!!u()){p(!0);try{const i={type:s.type,amount:parseFloat(s.amount),date:s.date,source:s.source.trim(),description:s.description.trim(),reference:s.reference.trim(),partnerId:s.partnerId||null,notes:s.notes.trim()};l?(await v(l.id,i),N("Cash Injection Updated","Cash injection has been updated successfully")):(await w(i),N("Cash Injection Added","New cash injection has been recorded successfully")),g()}catch(i){console.error("Cash injection submission error:",i),c("Submission Failed",i.message||"Failed to record cash injection")}finally{p(!1)}}},D=t=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(t||0);return e.jsx(G,{isOpen:!0,onClose:g,size:"medium",children:e.jsx("div",{className:"bg-white rounded-lg shadow-xl p-5",children:e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:l?"Edit Cash Injection":"Add Cash Injection"}),e.jsxs("button",{onClick:g,className:"text-gray-400 hover:text-gray-600",children:[e.jsx("span",{className:"sr-only",children:"Close"}),e.jsx(Z,{className:"h-6 w-6"})]})]}),e.jsxs("form",{onSubmit:m,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"type",className:"block text-sm font-medium text-gray-700 mb-1",children:"Injection Type *"}),e.jsx("select",{id:"type",name:"type",value:s.type,onChange:y,className:`w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 ${n.type?"border-red-300 focus:border-red-500":"border-gray-300 focus:border-blue-500"}`,children:j.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))}),n.type&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:n.type})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"amount",className:"block text-sm font-medium text-gray-700 mb-1",children:"Amount ($) *"}),e.jsx("input",{type:"number",id:"amount",name:"amount",value:s.amount,onChange:y,min:"0",step:"0.01",className:`w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 ${n.amount?"border-red-300 focus:border-red-500":"border-gray-300 focus:border-blue-500"}`,placeholder:"0.00"}),n.amount&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:n.amount})]})]}),d?.requiresPartner&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"partnerId",className:"block text-sm font-medium text-gray-700 mb-1",children:"Partner *"}),e.jsxs("select",{id:"partnerId",name:"partnerId",value:s.partnerId,onChange:y,className:`w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 ${n.partnerId?"border-red-300 focus:border-red-500":"border-gray-300 focus:border-blue-500"}`,children:[e.jsx("option",{value:"",children:"Select a partner"}),I.map(t=>e.jsxs("option",{value:t.id,children:[t.name," (",t.ownershipPercent,"%)"]},t.id))]}),n.partnerId&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:n.partnerId})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"source",className:"block text-sm font-medium text-gray-700 mb-1",children:"Source *"}),e.jsx("input",{type:"text",id:"source",name:"source",value:s.source,onChange:y,className:`w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 ${n.source?"border-red-300 focus:border-red-500":"border-gray-300 focus:border-blue-500"}`,placeholder:"Source"}),n.source&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:n.source})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"date",className:"block text-sm font-medium text-gray-700 mb-1",children:"Date *"}),e.jsx("input",{type:"date",id:"date",name:"date",value:s.date,onChange:y,className:`w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 ${n.date?"border-red-300 focus:border-red-500":"border-gray-300 focus:border-blue-500"}`}),n.date&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:n.date})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 mb-1",children:"Description *"}),e.jsx("input",{type:"text",id:"description",name:"description",value:s.description,onChange:y,className:`w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 ${n.description?"border-red-300 focus:border-red-500":"border-gray-300 focus:border-blue-500"}`,placeholder:"Description"}),n.description&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:n.description})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"reference",className:"block text-sm font-medium text-gray-700 mb-1",children:"Reference Number"}),e.jsx("input",{type:"text",id:"reference",name:"reference",value:s.reference,onChange:y,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Reference number"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Optional reference for tracking"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"notes",className:"block text-sm font-medium text-gray-700 mb-1",children:"Additional Notes"}),e.jsx("textarea",{id:"notes",name:"notes",value:s.notes,onChange:y,rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Notes"})]}),s.amount&&e.jsxs("div",{className:"bg-green-50 rounded-lg p-4 border border-green-200",children:[e.jsx("h4",{className:"text-sm font-medium text-green-900 mb-2",children:"Cash Injection Summary"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-green-700",children:"Type:"}),e.jsx("span",{className:"font-semibold text-green-900",children:s.type})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-green-700",children:"Amount:"}),e.jsx("span",{className:"font-semibold text-green-900",children:D(s.amount)})]}),d?.requiresPartner&&s.partnerId&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-green-700",children:"Partner:"}),e.jsx("span",{className:"font-semibold text-green-900",children:I.find(t=>t.id===s.partnerId)?.name})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-green-700",children:"Date:"}),e.jsx("span",{className:"font-semibold text-green-900",children:new Date(s.date).toLocaleDateString()})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:g,disabled:b,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:b,className:"px-4 py-2 text-sm font-medium text-white bg-green-600 border border-transparent rounded-md shadow-sm hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50 disabled:cursor-not-allowed",children:b?"Processing...":l?"Update Injection":"Add Cash Injection"})]})]})]})})})}function Ce(){const{cashInjections:l=[],partners:g,deleteCashInjection:I}=W(),{showSuccessMessage:w,showErrorMessage:v,showConfirmDialog:N}=q(),[c,s]=k.useState(!1),[o,n]=k.useState(null),[C,b]=k.useState("all"),j=[...C==="all"?l:l.filter(r=>r.type===C)].sort((r,f)=>new Date(f.date)-new Date(r.date)),d=l.reduce((r,f)=>(r[f.type]=(r[f.type]||0)+f.amount,r),{}),y=Object.values(d).reduce((r,f)=>r+f,0),u=r=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(r||0),m=r=>{n(r),s(!0)},D=async r=>{if(await N("Delete Cash Injection",`Are you sure you want to delete this ${u(r.amount)} ${r.type.toLowerCase()}? ${r.type==="Capital Contribution"?"This will also update the partner's equity account.":"This action cannot be undone."}`))try{await I(r.id),w("Injection Deleted","Cash injection has been removed successfully")}catch(A){v("Delete Failed",A.message||"Failed to delete cash injection")}},t=r=>{switch(r){case"Capital Contribution":return e.jsx(X,{className:"h-5 w-5 text-purple-600"});case"Loan":return e.jsx(se,{className:"h-5 w-5 text-orange-600"});case"Other Income":return e.jsx(L,{className:"h-5 w-5 text-green-600"});case"Opening Balance":return e.jsx(ee,{className:"h-5 w-5 text-blue-600"});default:return e.jsx(V,{className:"h-5 w-5 text-gray-600"})}},i=r=>{switch(r){case"Capital Contribution":return"bg-purple-100 text-purple-800";case"Loan":return"bg-orange-100 text-orange-800";case"Other Income":return"bg-green-100 text-green-800";case"Opening Balance":return"bg-blue-100 text-blue-800";default:return"bg-gray-100 text-gray-800"}};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Cash Injections"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Track capital contributions, loans, and other cash additions"})]}),e.jsxs("button",{onClick:()=>{n(null),s(!0)},className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700",children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),"Add Cash Injection"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 mb-6",children:[e.jsx("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Injections"}),e.jsx("p",{className:"text-xl font-semibold text-gray-900",children:u(y)})]}),e.jsx(V,{className:"h-8 w-8 text-green-500"})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Capital Contributions"}),e.jsx("p",{className:"text-lg font-semibold text-purple-600",children:u(d["Capital Contribution"]||0)})]}),e.jsx(X,{className:"h-8 w-8 text-purple-500"})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Loans"}),e.jsx("p",{className:"text-lg font-semibold text-orange-600",children:u(d.Loan||0)})]}),e.jsx(se,{className:"h-8 w-8 text-orange-500"})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Other Income"}),e.jsx("p",{className:"text-lg font-semibold text-green-600",children:u(d["Other Income"]||0)})]}),e.jsx(L,{className:"h-8 w-8 text-green-500"})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Opening Balance"}),e.jsx("p",{className:"text-lg font-semibold text-blue-600",children:u(d["Opening Balance"]||0)})]}),e.jsx(ee,{className:"h-8 w-8 text-blue-500"})]})})]}),e.jsx("div",{className:"border-b border-gray-200 mb-4",children:e.jsxs("nav",{className:"-mb-px flex space-x-8",children:[e.jsxs("button",{onClick:()=>b("all"),className:`whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm ${C==="all"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:["All (",l.length,")"]}),["Capital Contribution","Loan","Other Income","Opening Balance"].map(r=>{const f=l.filter(A=>A.type===r).length;return e.jsxs("button",{onClick:()=>b(r),className:`whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm ${C===r?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[r," (",f,")"]},r)})]})}),j.length===0?e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-8 text-center",children:[e.jsx(V,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Cash Injections"}),e.jsx("p",{className:"text-gray-600",children:C==="all"?"No records found":`No ${C.toLowerCase()} records found`})]}):e.jsx("div",{className:"bg-white shadow overflow-hidden sm:rounded-md",children:e.jsx("ul",{className:"divide-y divide-gray-200",children:j.map(r=>{const f=r.partnerId?g.find(A=>A.id===r.partnerId):null;return e.jsx("li",{children:e.jsx("div",{className:"px-4 py-4 sm:px-6 hover:bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:t(r.type)}),e.jsxs("div",{className:"ml-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:r.description}),e.jsx("span",{className:`ml-3 inline-flex px-2 py-0.5 text-xs font-semibold rounded-full ${i(r.type)}`,children:r.type})]}),e.jsxs("div",{className:"mt-1 flex items-center text-sm text-gray-500",children:[e.jsx("span",{children:_(r.date)}),e.jsx("span",{className:"mx-2",children:"•"}),e.jsx("span",{children:r.source}),f&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"mx-2",children:"•"}),e.jsx("span",{className:"text-purple-600",children:f.name})]}),r.reference&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"mx-2",children:"•"}),e.jsxs("span",{className:"flex items-center",children:[e.jsx(de,{className:"h-3 w-3 mr-1"}),r.reference]})]})]}),r.notes&&e.jsx("p",{className:"mt-1 text-xs text-gray-500 italic",children:r.notes})]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"text-right mr-4",children:e.jsxs("p",{className:"text-lg font-semibold text-green-600",children:["+",u(r.amount)]})}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>m(r),className:"text-gray-400 hover:text-blue-600",title:"Edit injection",children:e.jsx(ne,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>D(r),className:"text-gray-400 hover:text-red-600",title:"Delete injection",children:e.jsx(Y,{className:"h-4 w-4"})})]})]})]})})},r.id)})})}),c&&e.jsx(ve,{injection:o,onClose:()=>{s(!1),n(null)}})]})}function Ee(){const{partners:l,withdrawals:g,cashFlows:I,cashInjections:w=[],sales:v,expenses:N,containers:c,syncFinanceData:s}=W(),{showSuccessMessage:o,showInfoMessage:n,showErrorMessage:C}=q(),[b,p]=k.useState("dashboard"),j=new Date().toISOString().split("T")[0],d=v.filter(h=>h.date===j),y=N.filter(h=>h.date===j),u=g.filter(h=>h.date===j),m=d.reduce((h,S)=>h+(S.totalAmount||0),0),D=y.reduce((h,S)=>h+S.amount,0)+u.reduce((h,S)=>h+S.amount,0),t=v.reduce((h,S)=>h+(S.totalAmount||0),0),i=w.reduce((h,S)=>h+(S.amount||0),0),r=N.reduce((h,S)=>h+S.amount,0),f=g.reduce((h,S)=>h+S.amount,0),A=t+i,O=t+i-r-f,E=l.reduce((h,S)=>{const P=S.capitalAccount||{};return h+(P.initialInvestment||0)+(P.profitShare||0)-(P.totalWithdrawn||0)},0),M=2e3,U=Math.max(0,O-M),T=h=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(h||0),R=[{id:"dashboard",name:"Cash Flow",icon:L},{id:"injections",name:"Cash Injections",icon:K},{id:"withdrawals",name:"Withdrawals",icon:X},{id:"partners",name:"Partners",icon:te}];return e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsx("div",{className:"py-6",children:e.jsxs("div",{className:"sm:max-w-7xl sm:mx-auto sm:px-6 lg:px-8",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Finance Management"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Manage cash flow, partner withdrawals, and equity distributions"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8",children:[e.jsx(B,{title:"Cash Position",value:T(O),subtitle:`${m>0?`+${T(m)} in`:""}${m>0&&D>0?" • ":""}${D>0?`-${T(D)} out`:""}`.trim()||"Current balance",icon:V,iconBgColor:"bg-green-100",iconColor:"text-green-600",trend:m-D>0?"up":m-D<0?"down":null}),e.jsx(B,{title:"Available Distribution",value:T(U),subtitle:`Reserve: ${T(M)}`,icon:he,iconBgColor:"bg-blue-100",iconColor:"text-blue-600"}),e.jsx(B,{title:"Total Equity",value:T(E),subtitle:`${l.length} partner${l.length!==1?"s":""}`,icon:te,iconBgColor:"bg-purple-100",iconColor:"text-purple-600"}),e.jsx(B,{title:"Today's Withdrawals",value:T(u.reduce((h,S)=>h+S.amount,0)),subtitle:`${u.length} transaction${u.length!==1?"s":""}`,icon:X,iconBgColor:u.length>0?"bg-orange-100":"bg-gray-100",iconColor:u.length>0?"text-orange-600":"text-gray-600"})]}),e.jsxs("div",{className:"bg-white shadow rounded-lg",children:[e.jsx("div",{className:"border-b border-gray-200",children:e.jsx("nav",{className:"-mb-px flex space-x-8 px-6","aria-label":"Tabs",children:R.map(h=>{const S=h.icon;return e.jsxs("button",{onClick:()=>p(h.id),className:`
                        whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm flex items-center justify-center sm:justify-start
                        ${b===h.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}
                      `,title:h.name,children:[e.jsx(S,{className:"h-5 w-5 sm:mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:h.name})]},h.id)})})}),e.jsxs("div",{className:"p-6",children:[b==="dashboard"&&e.jsx(ge,{currentCashPosition:O,openingBalance:A}),b==="injections"&&e.jsx(Ce,{}),b==="withdrawals"&&e.jsx(ye,{availableCash:U}),b==="partners"&&e.jsx(we,{})]})]})]})})})}export{Ee as default};
