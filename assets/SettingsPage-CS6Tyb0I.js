import{c,u as re,d as ne,i as oe,r as j,j as e,k as ie,T as I,b as L}from"./index-CdxIgPjh.js";/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],de=c("circle-check-big",le);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=[["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M5.782 5.782A7 7 0 0 0 9 19h8.5a4.5 4.5 0 0 0 1.307-.193",key:"yfwify"}],["path",{d:"M21.532 16.5A4.5 4.5 0 0 0 17.5 10h-1.79A7.008 7.008 0 0 0 10 5.07",key:"jlfiyv"}]],J=c("cloud-off",ce);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],he=c("download",pe);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 12a1 1 0 0 0-1 1v1a1 1 0 0 1-1 1 1 1 0 0 1 1 1v1a1 1 0 0 0 1 1",key:"1oajmo"}],["path",{d:"M14 18a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1 1 1 0 0 1-1-1v-1a1 1 0 0 0-1-1",key:"mpwhp6"}]],me=c("file-json",xe);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],fe=c("shield",ue);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],ge=c("upload",be);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.106-3.105c.32-.322.863-.22.983.218a6 6 0 0 1-8.259 7.057l-7.91 7.91a1 1 0 0 1-2.999-3l7.91-7.91a6 6 0 0 1 7.057-8.259c.438.12.54.662.219.984z",key:"1ngwbx"}]],q=c("wrench",we);function ve(){const{products:x,sales:m,expenses:u,containers:f,partners:b,withdrawals:g,cashInjections:w,metadata:i,loadData:F,fixMalformedIds:V,triggerSave:D,dispatch:ye}=re(),{showSuccessMessage:p,showErrorMessage:h,showConfirmDialog:y}=ne(),{forceSaveData:Y,isConnected:N}=oe(),[C,z]=j.useState(!1),[M,R]=j.useState(!1),[T,O]=j.useState(!1),[A,W]=j.useState(!1),$=j.useRef(null),Z=()=>{try{const o={metadata:{...i,backupDate:new Date().toISOString(),version:"1.0.0"},containers:f,products:x,sales:m,expenses:u,partners:b||[],withdrawals:g||[],cashInjections:w||[]},n=JSON.stringify(o,null,2),d=new Blob([n],{type:"application/json"}),l=URL.createObjectURL(d),r=document.createElement("a"),s=new Date().toISOString().split("T")[0];r.href=l,r.download=`backup_${s}.json`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(l),p("Backup Successful",`Your data has been downloaded as backup_${s}.json`)}catch(o){console.error("Backup failed:",o),h("Backup Failed","Failed to create backup. Please try again.")}},K=async()=>{const o=b?.filter(s=>s.id&&(s.id.includes("undefined")||s.id.includes("NaN")||s.id.includes("null")))||[],n=g?.filter(s=>s.id&&(s.id.includes("undefined")||s.id.includes("NaN")||s.id.includes("null")))||[],d=w?.filter(s=>s.id&&(s.id.includes("undefined")||s.id.includes("NaN")||s.id.includes("null")))||[],l=o.length+n.length+d.length;if(l===0){p("No Issues Found","All IDs are properly formatted. No fixes needed.");return}if(await y("Fix Malformed IDs",`Found ${l} malformed IDs:
• ${o.length} partners
• ${n.length} withdrawals
• ${d.length} cash injections

Do you want to fix them?`,"warning")){R(!0);try{V(),p("IDs Fixed Successfully",`Fixed ${l} malformed IDs. Please save your data to persist the changes.`)}catch(s){console.error("Failed to fix IDs:",s),h("Fix Failed","Failed to fix malformed IDs. Please try again.")}finally{R(!1)}}},Q=async o=>{const n=o.target.files?.[0];if(!n)return;if(!await y("Import Data","Are you sure you want to import this data? This will merge with your existing data and cannot be undone.","warning")){o.target.value="";return}z(!0);try{const l=await n.text(),r=JSON.parse(l);if(!r.products||!r.sales||!r.containers)throw new Error("Invalid backup file format");const s={product:Math.max(0,...x.map(t=>typeof t.id=="number"?t.id:0),i?.nextIds?.product||1),container:Math.max(0,...f.map(t=>{const a=parseInt(t.id?.replace("C","")||"0");return isNaN(a)?0:a}),i?.nextIds?.container||1),sale:Math.max(0,...m.map(t=>typeof t.id=="number"?t.id:0),i?.nextIds?.sale||1),expense:Math.max(0,...u.map(t=>typeof t.id=="number"?t.id:0),i?.nextIds?.expense||1),partner:Math.max(0,...(b||[]).map(t=>typeof t.id=="number"?t.id:0),i?.nextIds?.partner||1),withdrawal:Math.max(0,...(g||[]).map(t=>typeof t.id=="number"?t.id:0),i?.nextIds?.withdrawal||1),cashInjection:Math.max(0,...(w||[]).map(t=>typeof t.id=="number"?t.id:0),i?.nextIds?.cashInjection||1)},S={},se={},_=[...x];r.products?.forEach(t=>{const a=s.product+1;S[t.id]=a,s.product=a,_.push({...t,id:a})});const B=[...f];r.containers?.forEach(t=>{const a=`C${s.container+1}`;se[t.id]=a,s.container++;const ae={...t,id:a,products:t.products?.map(k=>({...k,productId:S[k.productId]||k.productId}))};B.push(ae)});const H=[...m];r.sales?.forEach(t=>{const a=s.sale+1;s.sale=a,H.push({...t,id:a,productId:S[t.productId]||t.productId})});const P=[...u];r.expenses?.forEach(t=>{const a=s.expense+1;s.expense=a,P.push({...t,id:a})});const E=[...b||[]];r.partners?.forEach(t=>{const a=s.partner+1;s.partner=a,E.push({...t,id:a})});const G=[...g||[]];r.withdrawals?.forEach(t=>{const a=s.withdrawal+1;s.withdrawal=a,G.push({...t,id:a})});const U=[...w||[]];r.cashInjections?.forEach(t=>{const a=s.cashInjection+1;s.cashInjection=a,U.push({...t,id:a})});const te={metadata:{...i,nextIds:{product:s.product+1,container:s.container+1,sale:s.sale+1,expense:s.expense+1,partner:s.partner+1,withdrawal:s.withdrawal+1,cashInjection:s.cashInjection+1,cashFlow:i?.nextIds?.cashFlow||1},lastUpdated:new Date().toISOString()},containers:B,products:_,sales:H,expenses:P,partners:E,withdrawals:G,cashInjections:U,cashFlows:[]};F(te);const v={products:r.products?.length||0,sales:r.sales?.length||0,expenses:r.expenses?.length||0,containers:r.containers?.length||0};p("Import Successful",`Imported ${v.products} products, ${v.sales} sales, ${v.expenses} expenses, and ${v.containers} containers`)}catch(l){console.error("Import failed:",l),h("Import Failed",l.message||"Failed to import data. Please ensure the file is a valid backup.")}finally{z(!1),o.target.value=""}},X=async()=>{if(!(!await y("Reset All Data","Are you sure you want to delete ALL data? This will permanently remove all products, sales, expenses, containers, partners, withdrawals, and cash injections.","warning")||!await y("Final Confirmation - Cannot Be Undone","This is your last chance. ALL data will be permanently deleted from your local storage and GitHub. Are you absolutely sure you want to continue?","warning"))){O(!0);try{const d={metadata:{version:"1.0.0",nextIds:{product:1,container:1,sale:1,expense:1,partner:1,withdrawal:1,cashInjection:1,cashFlow:1},lastUpdated:new Date().toISOString()},containers:[],products:[],sales:[],expenses:[],partners:[],withdrawals:[],cashInjections:[],cashFlows:[]};F(d),D&&await D(),p("Data Reset Successfully","All data has been permanently deleted. Your application is now in a clean state.")}catch(d){console.error("Reset failed:",d),h("Reset Failed","Failed to reset data. Please try again.")}finally{O(!1)}}},ee=async()=>{if(!N){h("Not Connected","Please connect to GitHub first from the header settings.");return}if(await y("Force Overwrite GitHub Data","This will overwrite the data.json file on GitHub with your current local data. Use this if the GitHub file is corrupted or has invalid JSON. Are you sure?","warning")){W(!0);try{const n={metadata:{...i,version:"1.0.0",lastUpdated:new Date().toISOString()},containers:f,products:x,sales:m,expenses:u,partners:b||[],withdrawals:g||[],cashInjections:w||[]};await Y(n,"Force overwrite corrupted data file"),p("Force Overwrite Successful","Your local data has been successfully pushed to GitHub, overwriting the previous file.")}catch(n){console.error("Force overwrite failed:",n),h("Force Overwrite Failed",n.message||"Failed to overwrite GitHub data. Please try again.")}finally{W(!1)}}};return e.jsx("div",{className:"min-h-screen",children:e.jsx("div",{className:"py-6",children:e.jsxs("div",{className:"sm:max-w-7xl sm:mx-auto sm:px-6 lg:px-8",children:[e.jsx("div",{className:"mb-6",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h2",{style:{fontSize:"24px",fontWeight:"bold",color:"#ebebeb"},children:"Settings"}),e.jsx("p",{style:{fontSize:"14px",color:"#b3b3b3",marginTop:"4px"},children:"Configure your application settings and integrations."})]})})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{style:{backgroundColor:"#2a2a2a",boxShadow:"0 1px 3px rgba(0, 0, 0, 0.1)",borderRadius:"8px",border:"1px solid #404040"},children:[e.jsxs("div",{className:"px-6 py-4",style:{borderBottom:"1px solid #404040"},children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(ie,{className:"h-5 w-5 mr-2",style:{color:"#b3b3b3"}}),e.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:"#ebebeb"},children:"Data Management"})]}),e.jsx("p",{style:{fontSize:"14px",color:"#b3b3b3",marginTop:"4px"},children:"Backup your data or import from a previous backup"})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between pb-6",style:{borderBottom:"1px solid #404040"},children:[e.jsxs("div",{className:"mb-4 sm:mb-0",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx(fe,{className:"h-5 w-5 text-green-500 mr-2"}),e.jsx("h4",{style:{fontSize:"14px",fontWeight:"500",color:"#ebebeb"},children:"Backup Data"})]}),e.jsx("p",{style:{fontSize:"14px",color:"#b3b3b3"},children:"Download all your data as a JSON file for safekeeping"}),e.jsxs("div",{style:{marginTop:"8px",fontSize:"12px",color:"#808080"},children:[e.jsxs("p",{children:["• Products: ",x.length," items"]}),e.jsxs("p",{children:["• Sales: ",m.length," records"]}),e.jsxs("p",{children:["• Expenses: ",u.length," records"]}),e.jsxs("p",{children:["• Containers: ",f.length," records"]})]})]}),e.jsxs("button",{onClick:Z,className:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-colors",children:[e.jsx(he,{className:"h-4 w-4 mr-2"}),"Backup Now"]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between pb-6",style:{borderBottom:"1px solid #404040"},children:[e.jsxs("div",{className:"mb-4 sm:mb-0",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx(q,{className:"h-5 w-5 text-orange-500 mr-2"}),e.jsx("h4",{style:{fontSize:"14px",fontWeight:"500",color:"#ebebeb"},children:"Fix Malformed IDs"})]}),e.jsx("p",{style:{fontSize:"14px",color:"#b3b3b3"},children:"Repair partner, withdrawal, and cash injection IDs that contain undefined or NaN"}),e.jsxs("div",{style:{marginTop:"8px",backgroundColor:"rgba(59, 130, 246, 0.1)",border:"1px solid rgba(59, 130, 246, 0.3)",borderRadius:"8px",padding:"16px",display:"flex",alignItems:"center"},children:[e.jsx(de,{style:{height:"20px",width:"20px",color:"#3b82f6",marginRight:"12px"}}),e.jsxs("div",{children:[e.jsx("p",{style:{fontSize:"14px",fontWeight:"500",color:"#3b82f6"},children:"Auto-Fix Available"}),e.jsx("p",{style:{fontSize:"14px",color:"#2563eb"},children:'This will automatically fix IDs like "Pundefined", "WNaN", etc.'}),e.jsx("p",{style:{fontSize:"14px",color:"#2563eb"},children:"All relationships between entities will be preserved."})]})]})]}),e.jsx("button",{onClick:K,disabled:M,className:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-orange-600 hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:M?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Fixing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"h-4 w-4 mr-2"}),"Fix IDs"]})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between pb-6",style:{borderBottom:"1px solid #404040"},children:[e.jsxs("div",{className:"mb-4 sm:mb-0",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx(J,{className:"h-5 w-5 text-yellow-500 mr-2"}),e.jsx("h4",{style:{fontSize:"14px",fontWeight:"500",color:"#ebebeb"},children:"Force Overwrite GitHub Data"})]}),e.jsx("p",{style:{fontSize:"14px",color:"#b3b3b3"},children:"Push your local data to GitHub, overwriting any corrupted or invalid JSON file"}),e.jsxs("div",{style:{marginTop:"8px",backgroundColor:"rgba(234, 179, 8, 0.1)",border:"1px solid rgba(234, 179, 8, 0.3)",borderRadius:"8px",padding:"16px",display:"flex",alignItems:"center"},children:[e.jsx(I,{style:{height:"20px",width:"20px",color:"#eab308",marginRight:"12px",flexShrink:0}}),e.jsxs("div",{children:[e.jsx("p",{style:{fontSize:"14px",fontWeight:"500",color:"#eab308"},children:"Recovery Tool"}),e.jsx("p",{style:{fontSize:"14px",color:"#ca8a04",marginTop:"4px"},children:'Use this if you see "Failed to parse data file" errors'}),e.jsx("p",{style:{fontSize:"14px",color:"#ca8a04"},children:"This will force-push your current local data to GitHub"})]})]})]}),e.jsx("button",{onClick:ee,disabled:A||!N,className:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-yellow-600 hover:bg-yellow-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-yellow-500 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:N?"":"Connect to GitHub first",children:A?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Overwriting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"Force Overwrite"]})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between",children:[e.jsxs("div",{className:"mb-4 sm:mb-0",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx(ge,{className:"h-5 w-5 text-blue-500 mr-2"}),e.jsx("h4",{style:{fontSize:"14px",fontWeight:"500",color:"#ebebeb"},children:"Import Data"})]}),e.jsx("p",{style:{fontSize:"14px",color:"#b3b3b3"},children:"Import and merge data from a backup file"}),e.jsxs("div",{style:{marginTop:"8px",backgroundColor:"rgba(245, 158, 11, 0.1)",border:"1px solid rgba(245, 158, 11, 0.3)",borderRadius:"8px",padding:"16px",display:"flex",alignItems:"center"},children:[e.jsx(I,{style:{height:"20px",width:"20px",color:"#f59e0b",marginRight:"12px"}}),e.jsxs("div",{children:[e.jsx("p",{style:{fontSize:"14px",fontWeight:"500",color:"#f59e0b"},children:"Important:"}),e.jsx("p",{style:{fontSize:"14px",color:"#d97706",marginTop:"4px"},children:"• Import will merge data with existing records"}),e.jsx("p",{style:{fontSize:"14px",color:"#d97706"},children:"• Duplicate IDs will be automatically reassigned"}),e.jsx("p",{style:{fontSize:"14px",color:"#d97706"},children:"• This action cannot be undone"})]})]})]}),e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsx("input",{ref:$,type:"file",accept:".json",onChange:Q,className:"hidden"}),e.jsx("button",{onClick:()=>$.current?.click(),disabled:C,className:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:C?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Importing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(me,{className:"h-4 w-4 mr-2"}),"Choose File"]})})]})]})]})]}),e.jsxs("div",{style:{backgroundColor:"#2a2a2a",boxShadow:"0 1px 3px rgba(0, 0, 0, 0.1)",borderRadius:"8px",border:"1px solid #7f1d1d"},children:[e.jsxs("div",{className:"px-6 py-4",style:{borderBottom:"1px solid #7f1d1d"},children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(I,{className:"h-5 w-5 mr-2",style:{color:"#ef4444"}}),e.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:"#ef4444"},children:"Danger Zone"})]}),e.jsx("p",{style:{fontSize:"14px",color:"#b3b3b3",marginTop:"4px"},children:"Irreversible and destructive actions"})]}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between",children:[e.jsxs("div",{className:"mb-4 sm:mb-0",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx(L,{className:"h-5 w-5 text-red-500 mr-2"}),e.jsx("h4",{style:{fontSize:"14px",fontWeight:"500",color:"#ebebeb"},children:"Reset All Data"})]}),e.jsx("p",{style:{fontSize:"14px",color:"#b3b3b3"},children:"Permanently delete all data from the application"}),e.jsxs("div",{style:{marginTop:"8px",backgroundColor:"rgba(239, 68, 68, 0.1)",border:"1px solid rgba(239, 68, 68, 0.3)",borderRadius:"8px",padding:"16px",display:"flex",alignItems:"center"},children:[e.jsx(I,{style:{height:"20px",width:"20px",color:"#ef4444",marginRight:"12px",flexShrink:0}}),e.jsxs("div",{children:[e.jsx("p",{style:{fontSize:"14px",fontWeight:"500",color:"#ef4444"},children:"Warning: This action is permanent!"}),e.jsx("p",{style:{fontSize:"14px",color:"#dc2626",marginTop:"4px"},children:"• All products, sales, expenses, and containers will be deleted"}),e.jsx("p",{style:{fontSize:"14px",color:"#dc2626"},children:"• All partners, withdrawals, and cash injections will be removed"}),e.jsx("p",{style:{fontSize:"14px",color:"#dc2626"},children:"• This action CANNOT be undone"}),e.jsx("p",{style:{fontSize:"14px",color:"#dc2626",fontWeight:"500",marginTop:"8px"},children:"⚠️ Make sure to backup your data first!"})]})]})]}),e.jsx("button",{onClick:X,disabled:T,className:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:T?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Resetting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),"Reset All Data"]})})]})})]})]})]})})})}export{ve as default};
