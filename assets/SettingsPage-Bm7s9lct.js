import{c as l,u as H,d as V,r as I,j as e,k as Y,T as Z}from"./index-CnsNA1Vq.js";/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],K=l("circle-check-big",G);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],X=l("download",Q);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 12a1 1 0 0 0-1 1v1a1 1 0 0 1-1 1 1 1 0 0 1 1 1v1a1 1 0 0 0 1 1",key:"1oajmo"}],["path",{d:"M14 18a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1 1 1 0 0 1-1-1v-1a1 1 0 0 0-1-1",key:"mpwhp6"}]],se=l("file-json",ee);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],te=l("shield",ae);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],re=l("upload",ne);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.106-3.105c.32-.322.863-.22.983.218a6 6 0 0 1-8.259 7.057l-7.91 7.91a1 1 0 0 1-2.999-3l7.91-7.91a6 6 0 0 1 7.057-8.259c.438.12.54.662.219.984z",key:"1ngwbx"}]],R=l("wrench",de);function le(){const{products:m,sales:x,expenses:h,containers:p,partners:u,withdrawals:f,cashInjections:g,metadata:d,loadData:U,fixMalformedIds:L,dispatch:ie}=H(),{showSuccessMessage:b,showErrorMessage:j,showConfirmDialog:v}=V(),[k,D]=I.useState(!1),[F,M]=I.useState(!1),S=I.useRef(null),T=()=>{try{const i={metadata:{...d,backupDate:new Date().toISOString(),version:"1.0.0"},containers:p,products:m,sales:x,expenses:h,partners:u||[],withdrawals:f||[],cashInjections:g||[]},o=JSON.stringify(i,null,2),c=new Blob([o],{type:"application/json"}),r=URL.createObjectURL(c),n=document.createElement("a"),s=new Date().toISOString().split("T")[0];n.href=r,n.download=`backup_${s}.json`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(r),b("Backup Successful",`Your data has been downloaded as backup_${s}.json`)}catch(i){console.error("Backup failed:",i),j("Backup Failed","Failed to create backup. Please try again.")}},A=async()=>{const i=u?.filter(s=>s.id&&(s.id.includes("undefined")||s.id.includes("NaN")||s.id.includes("null")))||[],o=f?.filter(s=>s.id&&(s.id.includes("undefined")||s.id.includes("NaN")||s.id.includes("null")))||[],c=g?.filter(s=>s.id&&(s.id.includes("undefined")||s.id.includes("NaN")||s.id.includes("null")))||[],r=i.length+o.length+c.length;if(r===0){b("No Issues Found","All IDs are properly formatted. No fixes needed.");return}if(await v("Fix Malformed IDs",`Found ${r} malformed IDs:
• ${i.length} partners
• ${o.length} withdrawals
• ${c.length} cash injections

Do you want to fix them?`,"warning")){M(!0);try{L(),b("IDs Fixed Successfully",`Fixed ${r} malformed IDs. Please save your data to persist the changes.`)}catch(s){console.error("Failed to fix IDs:",s),j("Fix Failed","Failed to fix malformed IDs. Please try again.")}finally{M(!1)}}},z=async i=>{const o=i.target.files?.[0];if(!o)return;if(!await v("Import Data","Are you sure you want to import this data? This will merge with your existing data and cannot be undone.","warning")){i.target.value="";return}D(!0);try{const r=await o.text(),n=JSON.parse(r);if(!n.products||!n.sales||!n.containers)throw new Error("Invalid backup file format");const s={product:Math.max(0,...m.map(a=>typeof a.id=="number"?a.id:0),d?.nextIds?.product||1),container:Math.max(0,...p.map(a=>{const t=parseInt(a.id?.replace("C","")||"0");return isNaN(t)?0:t}),d?.nextIds?.container||1),sale:Math.max(0,...x.map(a=>typeof a.id=="number"?a.id:0),d?.nextIds?.sale||1),expense:Math.max(0,...h.map(a=>typeof a.id=="number"?a.id:0),d?.nextIds?.expense||1),partner:Math.max(0,...(u||[]).map(a=>typeof a.id=="number"?a.id:0),d?.nextIds?.partner||1),withdrawal:Math.max(0,...(f||[]).map(a=>typeof a.id=="number"?a.id:0),d?.nextIds?.withdrawal||1),cashInjection:Math.max(0,...(g||[]).map(a=>typeof a.id=="number"?a.id:0),d?.nextIds?.cashInjection||1)},y={},J={},C=[...m];n.products?.forEach(a=>{const t=s.product+1;y[a.id]=t,s.product=t,C.push({...a,id:t})});const $=[...p];n.containers?.forEach(a=>{const t=`C${s.container+1}`;J[a.id]=t,s.container++;const q={...a,id:t,products:a.products?.map(N=>({...N,productId:y[N.productId]||N.productId}))};$.push(q)});const E=[...x];n.sales?.forEach(a=>{const t=s.sale+1;s.sale=t,E.push({...a,id:t,productId:y[a.productId]||a.productId})});const _=[...h];n.expenses?.forEach(a=>{const t=s.expense+1;s.expense=t,_.push({...a,id:t})});const P=[...u||[]];n.partners?.forEach(a=>{const t=s.partner+1;s.partner=t,P.push({...a,id:t})});const B=[...f||[]];n.withdrawals?.forEach(a=>{const t=s.withdrawal+1;s.withdrawal=t,B.push({...a,id:t})});const O=[...g||[]];n.cashInjections?.forEach(a=>{const t=s.cashInjection+1;s.cashInjection=t,O.push({...a,id:t})});const W={metadata:{...d,nextIds:{product:s.product+1,container:s.container+1,sale:s.sale+1,expense:s.expense+1,partner:s.partner+1,withdrawal:s.withdrawal+1,cashInjection:s.cashInjection+1,cashFlow:d?.nextIds?.cashFlow||1},lastUpdated:new Date().toISOString()},containers:$,products:C,sales:E,expenses:_,partners:P,withdrawals:B,cashInjections:O,cashFlows:[]};U(W);const w={products:n.products?.length||0,sales:n.sales?.length||0,expenses:n.expenses?.length||0,containers:n.containers?.length||0};b("Import Successful",`Imported ${w.products} products, ${w.sales} sales, ${w.expenses} expenses, and ${w.containers} containers`)}catch(r){console.error("Import failed:",r),j("Import Failed",r.message||"Failed to import data. Please ensure the file is a valid backup.")}finally{D(!1),i.target.value=""}};return e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsx("div",{className:"py-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsx("div",{className:"mb-6",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Settings"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Configure your application settings and integrations."})]})})}),e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white shadow rounded-lg",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Y,{className:"h-5 w-5 text-gray-600 mr-2"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Data Management"})]}),e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:"Backup your data or import from a previous backup"})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between pb-6 border-b border-gray-200",children:[e.jsxs("div",{className:"mb-4 sm:mb-0",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx(te,{className:"h-5 w-5 text-green-500 mr-2"}),e.jsx("h4",{className:"text-base font-medium text-gray-900",children:"Backup Data"})]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Download all your data as a JSON file for safekeeping"}),e.jsxs("div",{className:"mt-2 text-xs text-gray-500",children:[e.jsxs("p",{children:["• Products: ",m.length," items"]}),e.jsxs("p",{children:["• Sales: ",x.length," records"]}),e.jsxs("p",{children:["• Expenses: ",h.length," records"]}),e.jsxs("p",{children:["• Containers: ",p.length," records"]})]})]}),e.jsxs("button",{onClick:T,className:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-colors",children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),"Backup Now"]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between pb-6 border-b border-gray-200",children:[e.jsxs("div",{className:"mb-4 sm:mb-0",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx(R,{className:"h-5 w-5 text-orange-500 mr-2"}),e.jsx("h4",{className:"text-base font-medium text-gray-900",children:"Fix Malformed IDs"})]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Repair partner, withdrawal, and cash injection IDs that contain undefined or NaN"}),e.jsx("div",{className:"mt-2 bg-blue-50 border border-blue-200 rounded-md p-3",children:e.jsxs("div",{className:"flex",children:[e.jsx(K,{className:"h-4 w-4 text-blue-400 mt-0.5"}),e.jsxs("div",{className:"ml-2",children:[e.jsx("p",{className:"text-xs text-blue-700",children:'This will automatically fix IDs like "Pundefined", "WNaN", etc.'}),e.jsx("p",{className:"text-xs text-blue-700",children:"All relationships between entities will be preserved."})]})]})})]}),e.jsx("button",{onClick:A,disabled:F,className:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-orange-600 hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:F?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Fixing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"h-4 w-4 mr-2"}),"Fix IDs"]})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between",children:[e.jsxs("div",{className:"mb-4 sm:mb-0",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx(re,{className:"h-5 w-5 text-blue-500 mr-2"}),e.jsx("h4",{className:"text-base font-medium text-gray-900",children:"Import Data"})]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Import and merge data from a backup file"}),e.jsx("div",{className:"mt-2 bg-yellow-50 border border-yellow-200 rounded-md p-3",children:e.jsxs("div",{className:"flex",children:[e.jsx(Z,{className:"h-4 w-4 text-yellow-400 mt-0.5"}),e.jsxs("div",{className:"ml-2",children:[e.jsx("h5",{className:"text-xs font-medium text-yellow-800",children:"Important:"}),e.jsx("p",{className:"text-xs text-yellow-700 mt-1",children:"• Import will merge data with existing records"}),e.jsx("p",{className:"text-xs text-yellow-700",children:"• Duplicate IDs will be automatically reassigned"}),e.jsx("p",{className:"text-xs text-yellow-700",children:"• This action cannot be undone"})]})]})})]}),e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsx("input",{ref:S,type:"file",accept:".json",onChange:z,className:"hidden"}),e.jsx("button",{onClick:()=>S.current?.click(),disabled:k,className:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:k?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Importing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(se,{className:"h-4 w-4 mr-2"}),"Choose File"]})})]})]})]})]})})]})})})}export{le as default};
