import{c as K,r as D,j as e,X as G,u as O,d as R,f as oe,T as ie,W as Z,D as X,e as Q,b as ee,S as te,g as ce}from"./index-CnsNA1Vq.js";import{f as _}from"./dateFormatter-DEoQwZ0j.js";import{M as J}from"./Modal-Dw5js9Bu.js";import{S as W}from"./StatCard-BhXAGQ8R.js";import{T as U}from"./trending-up-Blfmwo1S.js";import{T as ne}from"./trending-down-BR5GL6uH.js";import{S as de}from"./search-ClOXqdvH.js";import{F as me,U as se}from"./users-fSnf2-xq.js";/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]],ae=K("building-2",ue);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],le=K("pen",xe);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=[["path",{d:"M11 17h3v2a1 1 0 0 0 1 1h2a1 1 0 0 0 1-1v-3a3.16 3.16 0 0 0 2-2h1a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1h-1a5 5 0 0 0-2-4V3a4 4 0 0 0-3.2 1.6l-.3.4H11a6 6 0 0 0-6 6v1a5 5 0 0 0 2 4v3a1 1 0 0 0 1 1h2a1 1 0 0 0 1-1z",key:"1piglc"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M2 8v1a2 2 0 0 0 2 2h1",key:"1env43"}]],pe=K("piggy-bank",he);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],re=K("user",be);function ge({expectedBalance:l,onReconcile:h,onClose:I}){const[p,y]=D.useState(l.toString()),[u,c]=D.useState(""),s=2e3,a=parseFloat(p||0)-l,r=Math.max(0,parseFloat(p||0)-s),C=f=>{f.preventDefault(),h({actualCount:parseFloat(p),availableForDistribution:r,reservedAmount:s,notes:u.trim()})},g=f=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(f||0);return e.jsx(J,{isOpen:!0,onClose:I,size:"medium",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Daily Cash Reconciliation"}),e.jsx("button",{onClick:I,className:"text-gray-400 hover:text-gray-600",children:e.jsx(G,{className:"h-6 w-6"})})]}),e.jsxs("form",{onSubmit:C,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Expected Balance"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:g(l)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Actual Count *"}),e.jsx("input",{type:"number",value:p,onChange:f=>y(f.target.value),step:"0.01",required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md"})]}),a!==0&&e.jsx("div",{className:`p-3 rounded ${a>0?"bg-green-50":"bg-red-50"}`,children:e.jsxs("p",{className:"text-sm font-medium",children:["Discrepancy: ",g(a)]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes"}),e.jsx("textarea",{value:u,onChange:f=>c(f.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md",placeholder:"Add any notes about the reconciliation..."})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:I,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700",children:"Reconcile"})]})]})]})})}function fe({currentCashPosition:l,openingBalance:h}){const{sales:I,expenses:p,withdrawals:y,cashInjections:u=[],cashFlows:c,addCashFlow:s}=O(),{showSuccessMessage:a,showErrorMessage:r}=R(),[C,g]=D.useState(!1),f=new Date().toISOString().split("T")[0],N=I.reduce((o,i)=>o+(i.totalAmount||0),0);u.reduce((o,i)=>o+(i.amount||0),0);const d=p.filter(o=>o.date<f).reduce((o,i)=>o+i.amount,0),w=y.filter(o=>o.date<f).reduce((o,i)=>o+i.amount,0),v=u.filter(o=>o.date<f).reduce((o,i)=>o+i.amount,0),b=N+v-d-w,$=I.filter(o=>o.date===f),t=p.filter(o=>o.date===f),m=y.filter(o=>o.date===f),n=u.filter(o=>o.date===f),j=$.reduce((o,i)=>o+(i.totalAmount||0),0),k=n.reduce((o,i)=>o+(i.amount||0),0),T=j+k,A=t.reduce((o,i)=>o+i.amount,0),B=m.reduce((o,i)=>o+i.amount,0),L=A+B,q=T-L,M=b+q,z=c.find(o=>o.date===f),H=!!z,P=o=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(o||0),E=async o=>{try{await s({date:f,openingBalance:b,cashSales:T,cashExpenses:A,withdrawals:m.map(i=>i.id),theoreticalBalance:M,actualCount:o.actualCount,discrepancy:o.actualCount-M,availableForDistribution:o.availableForDistribution,reservedAmount:o.reservedAmount,notes:o.notes,reconciledBy:"Current User"}),a("Cash Reconciled","Daily cash flow has been reconciled successfully"),g(!1)}catch(i){r("Reconciliation Failed",i.message)}};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Today's Cash Flow"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:new Date().toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]}),!H&&e.jsx("button",{onClick:()=>g(!0),className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700",children:"Reconcile Cash"})]}),H?e.jsxs("div",{className:"mb-6 bg-green-50 border border-green-200 rounded-lg p-4 flex items-center",children:[e.jsx(oe,{className:"h-5 w-5 text-green-600 mr-3"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-900",children:"Cash Reconciled"}),e.jsxs("p",{className:"text-sm text-green-700",children:["Today's cash has been reconciled. Actual: ",P(z.actualCount)," | Discrepancy: ",P(z.discrepancy)]})]})]}):e.jsxs("div",{className:"mb-6 bg-yellow-50 border border-yellow-200 rounded-lg p-4 flex items-center",children:[e.jsx(ie,{className:"h-5 w-5 text-yellow-600 mr-3"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-yellow-900",children:"Pending Reconciliation"}),e.jsx("p",{className:"text-sm text-yellow-700",children:"Please reconcile today's cash before closing"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[e.jsx(W,{title:"Opening Balance",value:P(b),subtitle:`Total Revenue: ${P(N)}`,icon:Z,iconBgColor:"bg-gray-100",iconColor:"text-gray-600"}),e.jsx(W,{title:"Cash Inflows",value:`+${P(T)}`,subtitle:`Sales: ${P(j)} • Injections: ${P(k)}`,icon:U,iconBgColor:"bg-green-100",iconColor:"text-green-600",trend:T>0?"up":null}),e.jsx(W,{title:"Cash Outflows",value:`-${P(L)}`,subtitle:`Expenses: ${P(A)} • Withdrawals: ${P(B)}`,icon:ne,iconBgColor:"bg-red-100",iconColor:"text-red-600",trend:L>0?"down":null}),e.jsx(W,{title:"Expected Balance",value:P(M),subtitle:`Net: ${q>=0?"+":""}${P(q)}`,icon:X,iconBgColor:"bg-blue-100",iconColor:"text-blue-600",trend:q>0?"up":q<0?"down":null})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200",children:[e.jsx("div",{className:"px-4 py-3 border-b border-gray-200",children:e.jsx("h4",{className:"text-sm font-medium text-gray-900",children:"Cash Inflows by Date"})}),e.jsx("div",{className:"p-4",children:(()=>{const o={};I.forEach(x=>{o[x.date]||(o[x.date]={sales:0,injections:0,count:0}),o[x.date].sales+=x.totalAmount||0,o[x.date].count+=1}),u.forEach(x=>{o[x.date]||(o[x.date]={sales:0,injections:0,count:0}),o[x.date].injections+=x.amount||0,o[x.date].count+=1});const S=Object.keys(o).sort((x,F)=>F.localeCompare(x)).slice(0,10);return S.length===0?e.jsx("p",{className:"text-sm text-gray-500",children:"No cash inflows recorded"}):e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto custom-scrollbar",children:S.map(x=>{const F=o[x],Y=F.sales+F.injections,V=x===f;return e.jsxs("div",{className:`flex justify-between items-center ${V?"bg-blue-50 p-2 rounded":""}`,children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium text-gray-900",children:[_(x)," ",V&&e.jsx("span",{className:"text-xs text-blue-600 ml-1",children:"(Today)"})]}),e.jsxs("p",{className:"text-xs text-gray-500",children:[F.count," transaction",F.count!==1?"s":"",F.sales>0&&` • Sales: ${P(F.sales)}`,F.injections>0&&` • Injections: ${P(F.injections)}`]})]}),e.jsxs("span",{className:"text-sm font-medium text-green-600",children:["+",P(Y)]})]},x)})})})()})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200",children:[e.jsx("div",{className:"px-4 py-3 border-b border-gray-200",children:e.jsx("h4",{className:"text-sm font-medium text-gray-900",children:"Cash Outflows by Date"})}),e.jsx("div",{className:"p-4",children:(()=>{const o={};p.forEach(x=>{o[x.date]||(o[x.date]={expenses:0,withdrawals:0,count:0}),o[x.date].expenses+=x.amount||0,o[x.date].count+=1}),y.forEach(x=>{o[x.date]||(o[x.date]={expenses:0,withdrawals:0,count:0}),o[x.date].withdrawals+=x.amount||0,o[x.date].count+=1});const S=Object.keys(o).sort((x,F)=>F.localeCompare(x)).slice(0,10);return S.length===0?e.jsx("p",{className:"text-sm text-gray-500",children:"No cash outflows recorded"}):e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto custom-scrollbar",children:S.map(x=>{const F=o[x],Y=F.expenses+F.withdrawals,V=x===f;return e.jsxs("div",{className:`flex justify-between items-center ${V?"bg-red-50 p-2 rounded":""}`,children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium text-gray-900",children:[_(x)," ",V&&e.jsx("span",{className:"text-xs text-red-600 ml-1",children:"(Today)"})]}),e.jsxs("p",{className:"text-xs text-gray-500",children:[F.count," transaction",F.count!==1?"s":"",F.expenses>0&&` • Expenses: ${P(F.expenses)}`,F.withdrawals>0&&` • Withdrawals: ${P(F.withdrawals)}`]})]}),e.jsxs("span",{className:"text-sm font-medium text-red-600",children:["-",P(Y)]})]},x)})})})()})]})]}),C&&e.jsx(ge,{expectedBalance:M,onReconcile:E,onClose:()=>g(!1)})]})}function ye({availableCash:l,onClose:h}){const{partners:I,addWithdrawal:p}=O(),{showSuccessMessage:y,showErrorMessage:u}=R(),[c,s]=D.useState({partnerId:"",amount:"",type:"personal",purpose:"",notes:"",date:new Date().toISOString().split("T")[0],time:new Date().toTimeString().split(" ")[0].substring(0,5)}),[a,r]=D.useState({}),[C,g]=D.useState(!1),f=[{value:"personal",label:"Personal Draw"},{value:"business_expense",label:"Business Expense"},{value:"profit_distribution",label:"Profit Distribution"},{value:"loan",label:"Loan"}],N=async d=>{d.preventDefault();const w={};if(c.partnerId||(w.partnerId="Please select a partner"),!c.amount||parseFloat(c.amount)<=0?w.amount="Amount must be greater than 0":parseFloat(c.amount)>l&&(w.amount=`Cannot exceed available cash (${l.toFixed(2)})`),c.purpose||(w.purpose="Purpose is required"),Object.keys(w).length>0){r(w);return}g(!0);try{const v=I.find(b=>b.id===c.partnerId);await p({partnerId:c.partnerId,partnerName:v?.name||"Unknown",amount:parseFloat(c.amount),type:c.type,purpose:c.purpose,notes:c.notes,date:c.date,time:c.time}),y("Withdrawal Recorded","The withdrawal has been recorded successfully"),h()}catch(v){u("Operation Failed",v.message)}finally{g(!1)}};return e.jsx(J,{isOpen:!0,onClose:h,size:"medium",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Record Withdrawal"}),e.jsx("button",{onClick:h,className:"text-gray-400 hover:text-gray-600",children:e.jsx(G,{className:"h-6 w-6"})})]}),e.jsxs("form",{onSubmit:N,className:"p-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Partner *"}),e.jsxs("select",{value:c.partnerId,onChange:d=>s({...c,partnerId:d.target.value}),className:`w-full px-3 py-2 border rounded-md ${a.partnerId?"border-red-300":"border-gray-300"}`,children:[e.jsx("option",{value:"",children:"Select partner..."}),I.map(d=>e.jsxs("option",{value:d.id,children:[d.name," (",d.ownershipPercent,"%)"]},d.id))]}),a.partnerId&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.partnerId})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Amount ($) *"}),e.jsx("input",{type:"number",value:c.amount,onChange:d=>s({...c,amount:d.target.value}),step:"0.01",min:"0",className:`w-full px-3 py-2 border rounded-md ${a.amount?"border-red-300":"border-gray-300"}`}),a.amount&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.amount}),e.jsxs("p",{className:"mt-1 text-xs text-gray-500",children:["Available: $",l.toFixed(2)]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Type *"}),e.jsx("select",{value:c.type,onChange:d=>s({...c,type:d.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md",children:f.map(d=>e.jsx("option",{value:d.value,children:d.label},d.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Purpose *"}),e.jsx("input",{type:"text",value:c.purpose,onChange:d=>s({...c,purpose:d.target.value}),className:`w-full px-3 py-2 border rounded-md ${a.purpose?"border-red-300":"border-gray-300"}`}),a.purpose&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.purpose})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes"}),e.jsx("textarea",{value:c.notes,onChange:d=>s({...c,notes:d.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md"})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:h,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:C,className:"px-4 py-2 text-sm font-medium text-white bg-green-600 rounded-md hover:bg-green-700 disabled:opacity-50",children:C?"Recording...":"Record Withdrawal"})]})]})]})})}function je({availableCash:l}){const{partners:h,withdrawals:I,deleteWithdrawal:p}=O(),{showConfirmDialog:y,showSuccessMessage:u,showErrorMessage:c}=R(),[s,a]=D.useState(!1),[r,C]=D.useState(""),[g,f]=D.useState(""),[N,d]=D.useState(""),w=I.filter(t=>{const m=!r||t.purpose?.toLowerCase().includes(r.toLowerCase())||t.notes?.toLowerCase().includes(r.toLowerCase()),n=!g||t.partnerId===g,j=!N||t.type===N;return m&&n&&j}).sort((t,m)=>new Date(m.date)-new Date(t.date)),v=async t=>{if(await y("Delete Withdrawal",`Are you sure you want to delete this $${t.amount} withdrawal? This will update the partner's capital account.`,"danger"))try{await p(t.id),u("Withdrawal Deleted","The withdrawal has been removed and capital account updated")}catch(n){c("Delete Failed",n.message)}},b=t=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(t||0),$=w.reduce((t,m)=>t+m.amount,0);return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Withdrawal History"}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[w.length," withdrawals • ",b($)," total"]})]}),e.jsxs("button",{onClick:()=>a(!0),disabled:h.length===0||l<=0,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),"Record Withdrawal"]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mb-6",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(de,{className:"h-5 w-5 absolute left-3 top-3 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search withdrawals...",value:r,onChange:t=>C(t.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md"})]})}),e.jsxs("select",{value:g,onChange:t=>f(t.target.value),className:"px-3 py-2 border border-gray-300 rounded-md",children:[e.jsx("option",{value:"",children:"All Partners"}),h.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),e.jsxs("select",{value:N,onChange:t=>d(t.target.value),className:"px-3 py-2 border border-gray-300 rounded-md",children:[e.jsx("option",{value:"",children:"All Types"}),e.jsx("option",{value:"personal",children:"Personal Draw"}),e.jsx("option",{value:"business_expense",children:"Business Expense"}),e.jsx("option",{value:"profit_distribution",children:"Profit Distribution"}),e.jsx("option",{value:"loan",children:"Loan"})]})]}),w.length===0?e.jsx("div",{className:"text-center py-12 bg-white rounded-lg border border-gray-200",children:e.jsx("p",{className:"text-gray-500",children:"No withdrawals found"})}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Partner"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Amount"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Type"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Purpose"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:w.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:_(t.date)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:t.partnerName}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:b(t.amount)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-blue-100 text-blue-800",children:t.type?.replace("_"," ")})}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-900",children:t.purpose}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:e.jsx("button",{onClick:()=>v(t),className:"text-red-600 hover:text-red-900",children:e.jsx(ee,{className:"h-4 w-4"})})})]},t.id))})]})}),s&&e.jsx(ye,{availableCash:l,onClose:()=>a(!1)})]})}function Ne({partner:l,onClose:h}){const{partners:I,addPartner:p,updatePartner:y}=O(),{showSuccessMessage:u,showErrorMessage:c}=R(),[s,a]=D.useState({name:l?.name||"",email:l?.email||"",phoneNumber:l?.phoneNumber||"",ownershipPercent:l?.ownershipPercent?.toString()||"",initialInvestment:l?.capitalAccount?.initialInvestment?.toString()||"0",bankDetails:{accountName:l?.bankDetails?.accountName||"",accountNumber:l?.bankDetails?.accountNumber||"",bankName:l?.bankDetails?.bankName||""}}),[r,C]=D.useState({}),[g,f]=D.useState(!1),N=v=>{const{name:b,value:$}=v.target;if(b.startsWith("bank_")){const t=b.replace("bank_","");a(m=>({...m,bankDetails:{...m.bankDetails,[t]:$}}))}else a(t=>({...t,[b]:$}));r[b]&&C(t=>{const m={...t};return delete m[b],m})},d=()=>{const v={};if(s.name.trim()||(v.name="Partner name is required"),!s.ownershipPercent)v.ownershipPercent="Ownership percentage is required";else{const b=parseFloat(s.ownershipPercent);(b<=0||b>100)&&(v.ownershipPercent="Must be between 0 and 100");const $=I.filter(t=>t.id!==l?.id).reduce((t,m)=>t+(m.ownershipPercent||0),0);$+b>100&&(v.ownershipPercent=`Total ownership would exceed 100% (current: ${$}%)`)}return s.email&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s.email)&&(v.email="Invalid email format"),s.initialInvestment&&parseFloat(s.initialInvestment)<0&&(v.initialInvestment="Investment cannot be negative"),C(v),Object.keys(v).length===0},w=async v=>{if(v.preventDefault(),!!d()){f(!0);try{const b={name:s.name.trim(),email:s.email.trim(),phoneNumber:s.phoneNumber.trim(),ownershipPercent:parseFloat(s.ownershipPercent),initialInvestment:parseFloat(s.initialInvestment||0),bankDetails:{accountName:s.bankDetails.accountName.trim(),accountNumber:s.bankDetails.accountNumber.trim(),bankName:s.bankDetails.bankName.trim()}};l?(await y(l.id,b),u("Partner Updated",`${b.name}'s information has been updated`)):(await p(b),u("Partner Added",`${b.name} has been added successfully`)),h()}catch(b){console.error("Partner form submission error:",b),c("Operation Failed",b.message||"Failed to save partner")}finally{f(!1)}}};return e.jsx(J,{isOpen:!0,onClose:h,size:"medium",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:l?"Edit Partner":"Add New Partner"}),e.jsx("button",{onClick:h,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(G,{className:"h-6 w-6"})})]}),e.jsxs("form",{onSubmit:w,className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-4",children:"Basic Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 mb-1",children:"Full Name *"}),e.jsx("input",{type:"text",id:"name",name:"name",value:s.name,onChange:N,className:`w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 ${r.name?"border-red-300":"border-gray-300"}`,placeholder:"Partner name"}),r.name&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r.name})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"ownershipPercent",className:"block text-sm font-medium text-gray-700 mb-1",children:"Ownership (%) *"}),e.jsx("input",{type:"number",id:"ownershipPercent",name:"ownershipPercent",value:s.ownershipPercent,onChange:N,min:"0",max:"100",step:"0.01",className:`w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 ${r.ownershipPercent?"border-red-300":"border-gray-300"}`,placeholder:"50"}),r.ownershipPercent&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r.ownershipPercent})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-4",children:"Contact Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:"Email Address"}),e.jsx("input",{type:"email",id:"email",name:"email",value:s.email,onChange:N,className:`w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 ${r.email?"border-red-300":"border-gray-300"}`,placeholder:"Email address"}),r.email&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r.email})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"phoneNumber",className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone Number"}),e.jsx("input",{type:"tel",id:"phoneNumber",name:"phoneNumber",value:s.phoneNumber,onChange:N,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Phone number"})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-4",children:"Financial Information"}),e.jsx("div",{className:"grid grid-cols-1 gap-4",children:e.jsxs("div",{children:[e.jsx("label",{htmlFor:"initialInvestment",className:"block text-sm font-medium text-gray-700 mb-1",children:"Initial Investment ($)"}),e.jsx("input",{type:"number",id:"initialInvestment",name:"initialInvestment",value:s.initialInvestment,onChange:N,min:"0",step:"0.01",className:`w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 ${r.initialInvestment?"border-red-300":"border-gray-300"}`,placeholder:"Initial investment"}),r.initialInvestment&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r.initialInvestment})]})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-4",children:"Bank Details (Optional)"}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"bank_accountName",className:"block text-sm font-medium text-gray-700 mb-1",children:"Account Name"}),e.jsx("input",{type:"text",id:"bank_accountName",name:"bank_accountName",value:s.bankDetails.accountName,onChange:N,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Partner name"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"bank_bankName",className:"block text-sm font-medium text-gray-700 mb-1",children:"Bank Name"}),e.jsx("input",{type:"text",id:"bank_bankName",name:"bank_bankName",value:s.bankDetails.bankName,onChange:N,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Bank name"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"bank_accountNumber",className:"block text-sm font-medium text-gray-700 mb-1",children:"Account Number"}),e.jsx("input",{type:"text",id:"bank_accountNumber",name:"bank_accountNumber",value:s.bankDetails.accountNumber,onChange:N,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Account number"})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:h,disabled:g,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:g,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:g?"Saving...":l?"Update Partner":"Add Partner"})]})]})]})})}function we({partner:l,onClose:h}){const{withdrawals:I}=O(),p=I.filter(a=>a.partnerId===l.id).sort((a,r)=>new Date(r.date)-new Date(a.date)),y=l.capitalAccount||{},u=p.reduce((a,r)=>a+r.amount,0),c=(y.initialInvestment||0)+(y.profitShare||0)-u,s=a=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(a||0);return e.jsx(J,{isOpen:!0,onClose:h,size:"large",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-gray-200",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:l.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[l.ownershipPercent,"% Partner"]})]}),e.jsx("button",{onClick:h,className:"text-gray-400 hover:text-gray-600",children:e.jsx(G,{className:"h-6 w-6"})})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h4",{className:"text-base font-medium text-gray-900 mb-4",children:"Capital Account"}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Initial Investment"}),e.jsx("span",{className:"text-sm font-medium",children:s(y.initialInvestment||0)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Profit Share"}),e.jsx("span",{className:"text-sm font-medium",children:s(y.profitShare||0)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Total Withdrawn"}),e.jsxs("span",{className:"text-sm font-medium text-red-600",children:["-",s(u)]})]}),e.jsxs("div",{className:"flex justify-between pt-2 border-t border-gray-200",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",children:"Current Equity"}),e.jsx("span",{className:`text-base font-semibold ${c>=0?"text-green-600":"text-red-600"}`,children:s(c)})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-base font-medium text-gray-900 mb-4",children:"Recent Withdrawals"}),p.length===0?e.jsx("p",{className:"text-sm text-gray-500",children:"No withdrawals recorded"}):e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:p.slice(0,10).map(a=>e.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 rounded",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:s(a.amount)}),e.jsxs("p",{className:"text-xs text-gray-500",children:[a.type," - ",a.purpose]})]}),e.jsx("span",{className:"text-sm text-gray-600",children:_(a.date)})]},a.id))})]})]})]})})}function ve(){const{partners:l,withdrawals:h,deletePartner:I}=O(),{showConfirmDialog:p,showSuccessMessage:y,showErrorMessage:u}=R(),[c,s]=D.useState(!1),[a,r]=D.useState(null),[C,g]=D.useState(null),f=()=>{r(null),s(!0)},N=t=>{r(t),s(!0)},d=t=>{g(t)},w=async t=>{const m=h.filter(j=>j.partnerId===t.id);if(m.length>0){u("Cannot Delete Partner",`${t.name} has ${m.length} withdrawal records. Archive partner instead.`);return}if(await p("Delete Partner",`Are you sure you want to delete ${t.name}? This action cannot be undone.`,"danger"))try{await I(t.id),y("Partner Deleted",`${t.name} has been removed`)}catch(j){u("Delete Failed",j.message)}},v=t=>{const m=h.filter(A=>A.partnerId===t.id),n=m.reduce((A,B)=>A+B.amount,0),j=m.sort((A,B)=>new Date(B.date)-new Date(A.date))[0],k=t.capitalAccount||{},T=(k.initialInvestment||0)+(k.profitShare||0)-n;return{totalWithdrawn:n,lastWithdrawal:j,currentEquity:T,withdrawalCount:m.length}},b=t=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(t||0),$=t=>t?_(t):"Never";return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Partners"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Manage partner profiles and equity accounts"})]}),e.jsxs("button",{onClick:f,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),"Add Partner"]})]}),l.length===0?e.jsxs("div",{className:"text-center py-12 bg-white rounded-lg border-2 border-dashed border-gray-300",children:[e.jsx(re,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No Partners"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"No partners added."})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:l.map(t=>{const m=v(t),n=m.currentEquity>=0;return e.jsx("div",{className:"bg-white rounded-lg shadow hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-12 w-12 rounded-full bg-blue-100 flex items-center justify-center",children:e.jsx(re,{className:"h-6 w-6 text-blue-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("h4",{className:"text-lg font-medium text-gray-900",children:t.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[t.ownershipPercent,"% ownership"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("button",{onClick:()=>d(t),className:"text-blue-600 hover:text-blue-800 p-1",title:"View details",children:e.jsx(U,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>N(t),className:"text-gray-600 hover:text-gray-800 p-1",title:"Edit partner",children:e.jsx(le,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>w(t),className:"text-red-600 hover:text-red-800 p-1",title:"Delete partner",children:e.jsx(ee,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Current Equity"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:`text-lg font-semibold ${n?"text-green-600":"text-red-600"}`,children:b(m.currentEquity)}),n?e.jsx(U,{className:"h-4 w-4 text-green-600 ml-1"}):e.jsx(ne,{className:"h-4 w-4 text-red-600 ml-1"})]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Initial Investment"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:b(t.capitalAccount?.initialInvestment||0)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Total Withdrawn"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:b(m.totalWithdrawn)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Last Withdrawal"}),e.jsx("span",{className:"text-sm text-gray-500",children:$(m.lastWithdrawal?.date)})]})]}),(t.email||t.phoneNumber)&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200",children:[t.email&&e.jsxs("p",{className:"text-sm text-gray-600 truncate",children:["📧 ",t.email]}),t.phoneNumber&&e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["📱 ",t.phoneNumber]})]})]})},t.id)})}),c&&e.jsx(Ne,{partner:a,onClose:()=>{s(!1),r(null)}}),C&&e.jsx(we,{partner:C,onClose:()=>g(null)})]})}function Ce({injection:l,onClose:h}){const{partners:I,addCashInjection:p,updateCashInjection:y}=O(),{showSuccessMessage:u,showErrorMessage:c}=R(),[s,a]=D.useState({type:l?.type||"Capital Contribution",amount:l?.amount?.toString()||"",date:l?.date||new Date().toISOString().split("T")[0],source:l?.source||"",description:l?.description||"",reference:l?.reference||"",partnerId:l?.partnerId||"",notes:l?.notes||""}),[r,C]=D.useState({}),[g,f]=D.useState(!1),N=[{value:"Capital Contribution",label:"Capital Contribution",requiresPartner:!0},{value:"Loan",label:"Loan/Financing",requiresPartner:!1},{value:"Other Income",label:"Other Income",requiresPartner:!1},{value:"Opening Balance",label:"Opening Balance Adjustment",requiresPartner:!1}],d=N.find(t=>t.value===s.type),w=t=>{const{name:m,value:n}=t.target;a(j=>({...j,[m]:n})),r[m]&&C(j=>({...j,[m]:""})),m==="type"&&(N.find(k=>k.value===n)?.requiresPartner||a(k=>({...k,partnerId:""})))},v=()=>{const t={};return s.type||(t.type="Please select an injection type"),s.amount?parseFloat(s.amount)<=0&&(t.amount="Amount must be greater than 0"):t.amount="Amount is required",s.date||(t.date="Date is required"),s.source.trim()||(t.source="Source is required"),d?.requiresPartner&&!s.partnerId&&(t.partnerId="Please select a partner for capital contribution"),s.description.trim()||(t.description="Description is required"),C(t),Object.keys(t).length===0},b=async t=>{if(t.preventDefault(),!!v()){f(!0);try{const m={type:s.type,amount:parseFloat(s.amount),date:s.date,source:s.source.trim(),description:s.description.trim(),reference:s.reference.trim(),partnerId:s.partnerId||null,notes:s.notes.trim()};l?(await y(l.id,m),u("Cash Injection Updated","Cash injection has been updated successfully")):(await p(m),u("Cash Injection Added","New cash injection has been recorded successfully")),h()}catch(m){console.error("Cash injection submission error:",m),c("Submission Failed",m.message||"Failed to record cash injection")}finally{f(!1)}}},$=t=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(t||0);return e.jsx(J,{isOpen:!0,onClose:h,size:"medium",children:e.jsx("div",{className:"bg-white rounded-lg shadow-xl p-5",children:e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:l?"Edit Cash Injection":"Add Cash Injection"}),e.jsxs("button",{onClick:h,className:"text-gray-400 hover:text-gray-600",children:[e.jsx("span",{className:"sr-only",children:"Close"}),e.jsx(G,{className:"h-6 w-6"})]})]}),e.jsxs("form",{onSubmit:b,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"type",className:"block text-sm font-medium text-gray-700 mb-1",children:"Injection Type *"}),e.jsx("select",{id:"type",name:"type",value:s.type,onChange:w,className:`w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 ${r.type?"border-red-300 focus:border-red-500":"border-gray-300 focus:border-blue-500"}`,children:N.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))}),r.type&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r.type})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"amount",className:"block text-sm font-medium text-gray-700 mb-1",children:"Amount ($) *"}),e.jsx("input",{type:"number",id:"amount",name:"amount",value:s.amount,onChange:w,min:"0",step:"0.01",className:`w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 ${r.amount?"border-red-300 focus:border-red-500":"border-gray-300 focus:border-blue-500"}`,placeholder:"0.00"}),r.amount&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r.amount})]})]}),d?.requiresPartner&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"partnerId",className:"block text-sm font-medium text-gray-700 mb-1",children:"Partner *"}),e.jsxs("select",{id:"partnerId",name:"partnerId",value:s.partnerId,onChange:w,className:`w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 ${r.partnerId?"border-red-300 focus:border-red-500":"border-gray-300 focus:border-blue-500"}`,children:[e.jsx("option",{value:"",children:"Select a partner"}),I.map(t=>e.jsxs("option",{value:t.id,children:[t.name," (",t.ownershipPercent,"%)"]},t.id))]}),r.partnerId&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r.partnerId})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"source",className:"block text-sm font-medium text-gray-700 mb-1",children:"Source *"}),e.jsx("input",{type:"text",id:"source",name:"source",value:s.source,onChange:w,className:`w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 ${r.source?"border-red-300 focus:border-red-500":"border-gray-300 focus:border-blue-500"}`,placeholder:"Source"}),r.source&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r.source})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"date",className:"block text-sm font-medium text-gray-700 mb-1",children:"Date *"}),e.jsx("input",{type:"date",id:"date",name:"date",value:s.date,onChange:w,className:`w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 ${r.date?"border-red-300 focus:border-red-500":"border-gray-300 focus:border-blue-500"}`}),r.date&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r.date})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 mb-1",children:"Description *"}),e.jsx("input",{type:"text",id:"description",name:"description",value:s.description,onChange:w,className:`w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 ${r.description?"border-red-300 focus:border-red-500":"border-gray-300 focus:border-blue-500"}`,placeholder:"Description"}),r.description&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r.description})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"reference",className:"block text-sm font-medium text-gray-700 mb-1",children:"Reference Number"}),e.jsx("input",{type:"text",id:"reference",name:"reference",value:s.reference,onChange:w,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Reference number"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Optional reference for tracking"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"notes",className:"block text-sm font-medium text-gray-700 mb-1",children:"Additional Notes"}),e.jsx("textarea",{id:"notes",name:"notes",value:s.notes,onChange:w,rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Notes"})]}),s.amount&&e.jsxs("div",{className:"bg-green-50 rounded-lg p-4 border border-green-200",children:[e.jsx("h4",{className:"text-sm font-medium text-green-900 mb-2",children:"Cash Injection Summary"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-green-700",children:"Type:"}),e.jsx("span",{className:"font-semibold text-green-900",children:s.type})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-green-700",children:"Amount:"}),e.jsx("span",{className:"font-semibold text-green-900",children:$(s.amount)})]}),d?.requiresPartner&&s.partnerId&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-green-700",children:"Partner:"}),e.jsx("span",{className:"font-semibold text-green-900",children:I.find(t=>t.id===s.partnerId)?.name})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-green-700",children:"Date:"}),e.jsx("span",{className:"font-semibold text-green-900",children:new Date(s.date).toLocaleDateString()})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:h,disabled:g,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:g,className:"px-4 py-2 text-sm font-medium text-white bg-green-600 border border-transparent rounded-md shadow-sm hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50 disabled:cursor-not-allowed",children:g?"Processing...":l?"Update Injection":"Add Cash Injection"})]})]})]})})})}function Ie(){const{cashInjections:l=[],partners:h,deleteCashInjection:I}=O(),{showSuccessMessage:p,showErrorMessage:y,showConfirmDialog:u}=R(),[c,s]=D.useState(!1),[a,r]=D.useState(null),[C,g]=D.useState("all"),N=[...C==="all"?l:l.filter(n=>n.type===C)].sort((n,j)=>new Date(j.date)-new Date(n.date)),d=l.reduce((n,j)=>(n[j.type]=(n[j.type]||0)+j.amount,n),{}),w=Object.values(d).reduce((n,j)=>n+j,0),v=n=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(n||0),b=n=>{r(n),s(!0)},$=async n=>{if(await u("Delete Cash Injection",`Are you sure you want to delete this ${v(n.amount)} ${n.type.toLowerCase()}? ${n.type==="Capital Contribution"?"This will also update the partner's equity account.":"This action cannot be undone."}`))try{await I(n.id),p("Injection Deleted","Cash injection has been removed successfully")}catch(k){y("Delete Failed",k.message||"Failed to delete cash injection")}},t=n=>{switch(n){case"Capital Contribution":return e.jsx(Z,{className:"h-5 w-5 text-purple-600"});case"Loan":return e.jsx(ae,{className:"h-5 w-5 text-orange-600"});case"Other Income":return e.jsx(U,{className:"h-5 w-5 text-green-600"});case"Opening Balance":return e.jsx(te,{className:"h-5 w-5 text-blue-600"});default:return e.jsx(X,{className:"h-5 w-5 text-gray-600"})}},m=n=>{switch(n){case"Capital Contribution":return"bg-purple-100 text-purple-800";case"Loan":return"bg-orange-100 text-orange-800";case"Other Income":return"bg-green-100 text-green-800";case"Opening Balance":return"bg-blue-100 text-blue-800";default:return"bg-gray-100 text-gray-800"}};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Cash Injections"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Track capital contributions, loans, and other cash additions"})]}),e.jsxs("button",{onClick:()=>{r(null),s(!0)},className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700",children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),"Add Cash Injection"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 mb-6",children:[e.jsx("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Injections"}),e.jsx("p",{className:"text-xl font-semibold text-gray-900",children:v(w)})]}),e.jsx(X,{className:"h-8 w-8 text-green-500"})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Capital Contributions"}),e.jsx("p",{className:"text-lg font-semibold text-purple-600",children:v(d["Capital Contribution"]||0)})]}),e.jsx(Z,{className:"h-8 w-8 text-purple-500"})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Loans"}),e.jsx("p",{className:"text-lg font-semibold text-orange-600",children:v(d.Loan||0)})]}),e.jsx(ae,{className:"h-8 w-8 text-orange-500"})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Other Income"}),e.jsx("p",{className:"text-lg font-semibold text-green-600",children:v(d["Other Income"]||0)})]}),e.jsx(U,{className:"h-8 w-8 text-green-500"})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Opening Balance"}),e.jsx("p",{className:"text-lg font-semibold text-blue-600",children:v(d["Opening Balance"]||0)})]}),e.jsx(te,{className:"h-8 w-8 text-blue-500"})]})})]}),e.jsx("div",{className:"border-b border-gray-200 mb-4",children:e.jsxs("nav",{className:"-mb-px flex space-x-8",children:[e.jsxs("button",{onClick:()=>g("all"),className:`whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm ${C==="all"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:["All (",l.length,")"]}),["Capital Contribution","Loan","Other Income","Opening Balance"].map(n=>{const j=l.filter(k=>k.type===n).length;return e.jsxs("button",{onClick:()=>g(n),className:`whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm ${C===n?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[n," (",j,")"]},n)})]})}),N.length===0?e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-8 text-center",children:[e.jsx(X,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Cash Injections"}),e.jsx("p",{className:"text-gray-600",children:C==="all"?"No records found":`No ${C.toLowerCase()} records found`})]}):e.jsx("div",{className:"bg-white shadow overflow-hidden sm:rounded-md",children:e.jsx("ul",{className:"divide-y divide-gray-200",children:N.map(n=>{const j=n.partnerId?h.find(k=>k.id===n.partnerId):null;return e.jsx("li",{children:e.jsx("div",{className:"px-4 py-4 sm:px-6 hover:bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:t(n.type)}),e.jsxs("div",{className:"ml-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:n.description}),e.jsx("span",{className:`ml-3 inline-flex px-2 py-0.5 text-xs font-semibold rounded-full ${m(n.type)}`,children:n.type})]}),e.jsxs("div",{className:"mt-1 flex items-center text-sm text-gray-500",children:[e.jsx("span",{children:_(n.date)}),e.jsx("span",{className:"mx-2",children:"•"}),e.jsx("span",{children:n.source}),j&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"mx-2",children:"•"}),e.jsx("span",{className:"text-purple-600",children:j.name})]}),n.reference&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"mx-2",children:"•"}),e.jsxs("span",{className:"flex items-center",children:[e.jsx(me,{className:"h-3 w-3 mr-1"}),n.reference]})]})]}),n.notes&&e.jsx("p",{className:"mt-1 text-xs text-gray-500 italic",children:n.notes})]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"text-right mr-4",children:e.jsxs("p",{className:"text-lg font-semibold text-green-600",children:["+",v(n.amount)]})}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>b(n),className:"text-gray-400 hover:text-blue-600",title:"Edit injection",children:e.jsx(le,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>$(n),className:"text-gray-400 hover:text-red-600",title:"Delete injection",children:e.jsx(ee,{className:"h-4 w-4"})})]})]})]})})},n.id)})})}),c&&e.jsx(Ce,{injection:a,onClose:()=>{s(!1),r(null)}})]})}function Se(l,h,I){const p=l.reduce((s,a)=>s+(a.totalInvestment||0),0),y=h.reduce((s,a)=>s+(a.totalAmount||0),0),u=I.reduce((s,a)=>s+a.amount,0),c=y-u-p;return{totalContainerCost:p,totalSalesRevenue:y,totalExpenses:u,currentCashPosition:c}}function De(l,h,I){const p=[];l.forEach(a=>{const r=a.arrivalDate||a.orderDate||a.createdAt||"2024-01-01";p.push({date:r,type:"expense",category:"Container Purchase",description:`Container ${a.id} - ${a.name}`,amount:-(a.totalInvestment||0),reference:`container_${a.id}`})}),h.forEach(a=>{p.push({date:a.date,type:"sale",category:"Product Sale",description:`Sale #${a.id}`,amount:a.totalAmount||0,reference:`sale_${a.id}`})}),I.forEach(a=>{p.push({date:a.date,type:"expense",category:a.category,description:a.description,amount:-a.amount,reference:`expense_${a.id}`})}),p.sort((a,r)=>new Date(a.date)-new Date(r.date));let y=0;const u=[],c=p.reduce((a,r)=>{const C=r.date;return a[C]||(a[C]=[]),a[C].push(r),a},{});return Object.keys(c).sort((a,r)=>new Date(a)-new Date(r)).forEach(a=>{const r=c[a],C=r.filter(d=>d.amount>0).reduce((d,w)=>d+w.amount,0),g=r.filter(d=>d.amount<0).reduce((d,w)=>d+Math.abs(w.amount),0),f=y,N=y+C-g;y=N,u.push({id:`cf_${a}`,date:a,openingBalance:f,cashIn:C,cashOut:g,theoreticalBalance:N,actualBalance:N,discrepancy:0,transactions:r,reconciled:!0,reconciledBy:"System Init",reconciledAt:new Date().toISOString()})}),u}function ke(l){const{containers:h,sales:I,expenses:p}=l,y=Se(h,I,p),u=De(h,I,p),c=l.partners||[],s=new Date().toISOString().split("T")[0];let a=u.find(r=>r.date===s);if(!a){const r=u[u.length-1];a={id:`cf_${s}`,date:s,openingBalance:r?r.theoreticalBalance:0,cashIn:0,cashOut:0,theoreticalBalance:r?r.theoreticalBalance:0,actualBalance:r?r.theoreticalBalance:0,discrepancy:0,transactions:[],reconciled:!1},u.push(a)}return{partners:c,cashFlows:u,withdrawals:l.withdrawals||[],financialSummary:{...y,lastSync:new Date().toISOString(),syncedFromExistingData:!0}}}function Me(){const{partners:l,withdrawals:h,cashFlows:I,cashInjections:p=[],sales:y,expenses:u,containers:c,syncFinanceData:s}=O(),{showSuccessMessage:a,showInfoMessage:r,showErrorMessage:C}=R(),[g,f]=D.useState("dashboard"),[N,d]=D.useState(!1),[w,v]=D.useState(!1);D.useEffect(()=>{w||(b(!0),v(!0))},[]);const b=async(i=!1)=>{d(!0);try{const S=ke({containers:c,sales:y,expenses:u,partners:l,withdrawals:h});await s(S),i||a("Finance Data Synced",`Successfully synced ${S.cashFlows.length} cash flow records from existing transactions`)}catch(S){console.error("Sync error:",S),C("Sync Failed",S.message)}finally{d(!1)}},$=new Date().toISOString().split("T")[0],t=y.filter(i=>i.date===$),m=u.filter(i=>i.date===$),n=h.filter(i=>i.date===$),j=t.reduce((i,S)=>i+(S.totalAmount||0),0),k=m.reduce((i,S)=>i+S.amount,0)+n.reduce((i,S)=>i+S.amount,0),T=y.reduce((i,S)=>i+(S.totalAmount||0),0),A=p.reduce((i,S)=>i+(S.amount||0),0),B=u.reduce((i,S)=>i+S.amount,0),L=h.reduce((i,S)=>i+S.amount,0),q=T+A,M=T+A-B-L,z=l.reduce((i,S)=>{const x=S.capitalAccount||{};return i+(x.initialInvestment||0)+(x.profitShare||0)-(x.totalWithdrawn||0)},0),H=2e3,P=Math.max(0,M-H),E=i=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(i||0),o=[{id:"dashboard",name:"Cash Flow",icon:U},{id:"injections",name:"Cash Injections",icon:Q},{id:"withdrawals",name:"Withdrawals",icon:Z},{id:"partners",name:"Partners",icon:se}];return e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsx("div",{className:"py-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"mb-6 flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Finance Management"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Manage cash flow, partner withdrawals, and equity distributions"})]}),e.jsxs("button",{onClick:()=>b(!1),disabled:N,className:"inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50",title:"Sync financial data from existing transactions",children:[e.jsx(ce,{className:`h-4 w-4 mr-2 ${N?"animate-spin":""}`}),N?"Syncing...":"Sync Data"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8",children:[e.jsx(W,{title:"Cash Position",value:E(M),subtitle:`${j>0?`+${E(j)} in`:""}${j>0&&k>0?" • ":""}${k>0?`-${E(k)} out`:""}`.trim()||"Current balance",icon:X,iconBgColor:"bg-green-100",iconColor:"text-green-600",trend:j-k>0?"up":j-k<0?"down":null}),e.jsx(W,{title:"Available Distribution",value:E(P),subtitle:`Reserve: ${E(H)}`,icon:pe,iconBgColor:"bg-blue-100",iconColor:"text-blue-600"}),e.jsx(W,{title:"Total Equity",value:E(z),subtitle:`${l.length} partner${l.length!==1?"s":""}`,icon:se,iconBgColor:"bg-purple-100",iconColor:"text-purple-600"}),e.jsx(W,{title:"Today's Withdrawals",value:E(n.reduce((i,S)=>i+S.amount,0)),subtitle:`${n.length} transaction${n.length!==1?"s":""}`,icon:Z,iconBgColor:n.length>0?"bg-orange-100":"bg-gray-100",iconColor:n.length>0?"text-orange-600":"text-gray-600"})]}),e.jsxs("div",{className:"bg-white shadow rounded-lg",children:[e.jsx("div",{className:"border-b border-gray-200",children:e.jsx("nav",{className:"-mb-px flex space-x-8 px-6","aria-label":"Tabs",children:o.map(i=>{const S=i.icon;return e.jsxs("button",{onClick:()=>f(i.id),className:`
                        whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm flex items-center justify-center sm:justify-start
                        ${g===i.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}
                      `,title:i.name,children:[e.jsx(S,{className:"h-5 w-5 sm:mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:i.name})]},i.id)})})}),e.jsxs("div",{className:"p-6",children:[g==="dashboard"&&e.jsx(fe,{currentCashPosition:M,openingBalance:q}),g==="injections"&&e.jsx(Ie,{}),g==="withdrawals"&&e.jsx(je,{availableCash:P}),g==="partners"&&e.jsx(ve,{})]})]})]})})})}export{Me as default};
