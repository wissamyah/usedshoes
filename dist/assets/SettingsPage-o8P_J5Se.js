import{c as x,u as J,d as q,r as $,j as e,h as H,T as V}from"./index-BwFdBzJr.js";/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],A=x("download",z);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 12a1 1 0 0 0-1 1v1a1 1 0 0 1-1 1 1 1 0 0 1 1 1v1a1 1 0 0 0 1 1",key:"1oajmo"}],["path",{d:"M14 18a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1 1 1 0 0 1-1-1v-1a1 1 0 0 0-1-1",key:"mpwhp6"}]],Y=x("file-json",W);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],G=x("shield",Z);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],Q=x("upload",K);function se(){const{products:d,sales:i,expenses:l,containers:m,partners:u,withdrawals:f,cashInjections:g,metadata:r,loadData:B,dispatch:X}=J(),{showSuccessMessage:b,showErrorMessage:y,showConfirmDialog:O}=q(),[I,N]=$.useState(!1),v=$.useRef(null),R=()=>{try{const o={metadata:{...r,backupDate:new Date().toISOString(),version:"1.0.0"},containers:m,products:d,sales:i,expenses:l,partners:u||[],withdrawals:f||[],cashInjections:g||[]},p=JSON.stringify(o,null,2),k=new Blob([p],{type:"application/json"}),c=URL.createObjectURL(k),n=document.createElement("a"),a=new Date().toISOString().split("T")[0];n.href=c,n.download=`backup_${a}.json`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(c),b("Backup Successful",`Your data has been downloaded as backup_${a}.json`)}catch(o){console.error("Backup failed:",o),y("Backup Failed","Failed to create backup. Please try again.")}},U=async o=>{const p=o.target.files?.[0];if(!p)return;if(!await O("Import Data","Are you sure you want to import this data? This will merge with your existing data and cannot be undone.","warning")){o.target.value="";return}N(!0);try{const c=await p.text(),n=JSON.parse(c);if(!n.products||!n.sales||!n.containers)throw new Error("Invalid backup file format");const a={product:Math.max(0,...d.map(s=>typeof s.id=="number"?s.id:0),r?.nextIds?.product||1),container:Math.max(0,...m.map(s=>{const t=parseInt(s.id?.replace("C","")||"0");return isNaN(t)?0:t}),r?.nextIds?.container||1),sale:Math.max(0,...i.map(s=>typeof s.id=="number"?s.id:0),r?.nextIds?.sale||1),expense:Math.max(0,...l.map(s=>typeof s.id=="number"?s.id:0),r?.nextIds?.expense||1),partner:Math.max(0,...(u||[]).map(s=>typeof s.id=="number"?s.id:0),r?.nextIds?.partner||1),withdrawal:Math.max(0,...(f||[]).map(s=>typeof s.id=="number"?s.id:0),r?.nextIds?.withdrawal||1),cashInjection:Math.max(0,...(g||[]).map(s=>typeof s.id=="number"?s.id:0),r?.nextIds?.cashInjection||1)},w={},P={},M=[...d];n.products?.forEach(s=>{const t=a.product+1;w[s.id]=t,a.product=t,M.push({...s,id:t})});const D=[...m];n.containers?.forEach(s=>{const t=`C${a.container+1}`;P[s.id]=t,a.container++;const T={...s,id:t,products:s.products?.map(j=>({...j,productId:w[j.productId]||j.productId}))};D.push(T)});const S=[...i];n.sales?.forEach(s=>{const t=a.sale+1;a.sale=t,S.push({...s,id:t,productId:w[s.productId]||s.productId})});const C=[...l];n.expenses?.forEach(s=>{const t=a.expense+1;a.expense=t,C.push({...s,id:t})});const E=[...u||[]];n.partners?.forEach(s=>{const t=a.partner+1;a.partner=t,E.push({...s,id:t})});const F=[...f||[]];n.withdrawals?.forEach(s=>{const t=a.withdrawal+1;a.withdrawal=t,F.push({...s,id:t})});const _=[...g||[]];n.cashInjections?.forEach(s=>{const t=a.cashInjection+1;a.cashInjection=t,_.push({...s,id:t})});const L={metadata:{...r,nextIds:{product:a.product+1,container:a.container+1,sale:a.sale+1,expense:a.expense+1,partner:a.partner+1,withdrawal:a.withdrawal+1,cashInjection:a.cashInjection+1,cashFlow:r?.nextIds?.cashFlow||1},lastUpdated:new Date().toISOString()},containers:D,products:M,sales:S,expenses:C,partners:E,withdrawals:F,cashInjections:_,cashFlows:[]};B(L);const h={products:n.products?.length||0,sales:n.sales?.length||0,expenses:n.expenses?.length||0,containers:n.containers?.length||0};b("Import Successful",`Imported ${h.products} products, ${h.sales} sales, ${h.expenses} expenses, and ${h.containers} containers`)}catch(c){console.error("Import failed:",c),y("Import Failed",c.message||"Failed to import data. Please ensure the file is a valid backup.")}finally{N(!1),o.target.value=""}};return e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsx("div",{className:"py-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsx("div",{className:"mb-6",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Settings"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Configure your application settings and integrations."})]})})}),e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white shadow rounded-lg",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(H,{className:"h-5 w-5 text-gray-600 mr-2"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Data Management"})]}),e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:"Backup your data or import from a previous backup"})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between pb-6 border-b border-gray-200",children:[e.jsxs("div",{className:"mb-4 sm:mb-0",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx(G,{className:"h-5 w-5 text-green-500 mr-2"}),e.jsx("h4",{className:"text-base font-medium text-gray-900",children:"Backup Data"})]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Download all your data as a JSON file for safekeeping"}),e.jsxs("div",{className:"mt-2 text-xs text-gray-500",children:[e.jsxs("p",{children:["• Products: ",d.length," items"]}),e.jsxs("p",{children:["• Sales: ",i.length," records"]}),e.jsxs("p",{children:["• Expenses: ",l.length," records"]}),e.jsxs("p",{children:["• Containers: ",m.length," records"]})]})]}),e.jsxs("button",{onClick:R,className:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-colors",children:[e.jsx(A,{className:"h-4 w-4 mr-2"}),"Backup Now"]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between",children:[e.jsxs("div",{className:"mb-4 sm:mb-0",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx(Q,{className:"h-5 w-5 text-blue-500 mr-2"}),e.jsx("h4",{className:"text-base font-medium text-gray-900",children:"Import Data"})]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Import and merge data from a backup file"}),e.jsx("div",{className:"mt-2 bg-yellow-50 border border-yellow-200 rounded-md p-3",children:e.jsxs("div",{className:"flex",children:[e.jsx(V,{className:"h-4 w-4 text-yellow-400 mt-0.5"}),e.jsxs("div",{className:"ml-2",children:[e.jsx("h5",{className:"text-xs font-medium text-yellow-800",children:"Important:"}),e.jsx("p",{className:"text-xs text-yellow-700 mt-1",children:"• Import will merge data with existing records"}),e.jsx("p",{className:"text-xs text-yellow-700",children:"• Duplicate IDs will be automatically reassigned"}),e.jsx("p",{className:"text-xs text-yellow-700",children:"• This action cannot be undone"})]})]})})]}),e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsx("input",{ref:v,type:"file",accept:".json",onChange:U,className:"hidden"}),e.jsx("button",{onClick:()=>v.current?.click(),disabled:I,className:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:I?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Importing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),"Choose File"]})})]})]})]})]})})]})})})}export{se as default};
