import{c as Y,j as e,P as L,C as Z,T as M,b as ee,u as I,r as m,X as U,d as B,e as te,D as se}from"./index-CnsNA1Vq.js";import{T as W}from"./trending-up-Blfmwo1S.js";import{P as re}from"./pencil-DtMxSY_x.js";import ae from"./ProductForm-Bk8vPUxF.js";import{f as O}from"./dateFormatter-DEoQwZ0j.js";import{M as K}from"./Modal-Dw5js9Bu.js";import{S as C}from"./StatCard-BhXAGQ8R.js";import{A as ne}from"./archive-BnS4defz.js";/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=[["path",{d:"M21 10V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l2-1.14",key:"e7tb2h"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["line",{x1:"12",x2:"12",y1:"22",y2:"12",key:"a4e8g8"}],["path",{d:"m17 13 5 5m-5 0 5-5",key:"im3w4b"}]],ie=Y("package-x",le);function ce({products:t,containers:d,onEdit:u,onDelete:g,onViewMovement:x,onDestroy:l}){const c=s=>s===0?"text-red-600 bg-red-100":s<=5?"text-yellow-600 bg-yellow-100":"text-green-600 bg-green-100",r=s=>s===0?"Out of Stock":s<=5?"Low Stock":"In Stock",a=s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(s);return e.jsx("div",{className:"bg-white shadow overflow-hidden sm:rounded-md",children:e.jsxs("div",{className:"px-4 py-5 sm:p-6",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Product"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Category"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Stock (bags)"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Cost/kg"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Avg. Selling Price"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total Value"}),e.jsx("th",{scope:"col",className:"relative px-6 py-3",children:e.jsx("span",{className:"sr-only",children:"Actions"})})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:t.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10",children:e.jsx("div",{className:"h-10 w-10 rounded-lg bg-gray-200 flex items-center justify-center",children:e.jsx(L,{className:"h-6 w-6 text-gray-500"})})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.name}),s.description&&e.jsx("div",{className:"text-sm text-gray-500",children:s.description.length>50?`${s.description.substring(0,50)}...`:s.description})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800",children:s.category})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-900 mr-2",children:[s.currentStock," bags"]}),e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${c(s.currentStock)}`,children:r(s.currentStock)})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:a(s.costPerKg||s.costPerUnit)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:s.avgSellingPrice?e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",children:a(s.avgSellingPrice)}),s.avgSellingPrice>(s.costPerKg||s.costPerUnit||0)?e.jsx(W,{className:"h-4 w-4 text-green-500 ml-1"}):e.jsx(W,{className:"h-4 w-4 text-red-500 ml-1 transform rotate-180"}),s.totalSold>0&&e.jsxs("span",{className:"text-xs text-gray-500 ml-2",children:["(",s.totalSold," sold)"]})]}):e.jsx("span",{className:"text-sm text-gray-400 italic",children:"No sales yet"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:a(s.currentStock*(s.bagWeight||25)*(s.costPerKg||s.costPerUnit||0))}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>x(s),className:"text-green-600 hover:text-green-900 p-1 rounded-md hover:bg-green-50",title:"View product movement",children:e.jsx(Z,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>u(s),className:"text-blue-600 hover:text-blue-900 p-1 rounded-md hover:bg-blue-50",title:"Edit product",children:e.jsx(re,{className:"h-4 w-4"})}),s.currentStock>0&&e.jsx("button",{onClick:()=>l(s),className:"text-orange-600 hover:text-orange-900 p-1 rounded-md hover:bg-orange-50",title:"Destroy/damage product",children:e.jsx(M,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>g(s.id),className:"text-red-600 hover:text-red-900 p-1 rounded-md hover:bg-red-50",title:"Delete product",children:e.jsx(ee,{className:"h-4 w-4"})})]})})]},s.id))})]})}),t.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ie,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No products"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"No products match your current filters."})]})]})})}function oe({product:t,onEdit:d,onDelete:u,onViewMovement:g,onDestroy:x}){const l=s=>s===0?"text-red-600 bg-red-100":s<=5?"text-yellow-600 bg-yellow-100":"text-green-600 bg-green-100",c=s=>s===0?"Out of Stock":s<=5?"Low Stock":"In Stock",r=s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(s),a=t.currentStock*(t.bagWeight||25)*(t.costPerKg||t.costPerUnit||0);return e.jsxs("div",{className:"bg-white overflow-hidden shadow rounded-lg hover:shadow-md transition-shadow duration-200",children:[e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"flex-shrink-0 h-12 w-12",children:e.jsx("div",{className:"h-12 w-12 rounded-lg bg-gray-200 flex items-center justify-center",children:e.jsx("svg",{className:"h-7 w-7 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"})})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 truncate",children:t.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:["ID: ",t.id]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>g(t),className:"text-green-600 hover:text-green-800 p-1 rounded-md hover:bg-green-50",title:"View product movement",children:e.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})})}),e.jsx("button",{onClick:()=>d(t),className:"text-blue-600 hover:text-blue-800 p-1 rounded-md hover:bg-blue-50",title:"Edit product",children:e.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),t.currentStock>0&&x&&e.jsx("button",{onClick:()=>x(t),className:"text-orange-600 hover:text-orange-800 p-1 rounded-md hover:bg-orange-50",title:"Destroy/damage product",children:e.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),e.jsx("button",{onClick:()=>u(t.id),className:"text-red-600 hover:text-red-800 p-1 rounded-md hover:bg-red-50",title:"Delete product",children:e.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]}),e.jsx("div",{className:"flex items-center space-x-2 mb-4",children:e.jsx("span",{className:"px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800",children:t.category})}),t.description&&e.jsx("p",{className:"text-sm text-gray-600 mb-4 line-clamp-2",children:t.description}),e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:"Stock Level"}),e.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[e.jsxs("span",{className:"text-lg font-bold text-gray-900",children:[t.currentStock," bags"]}),e.jsx("span",{className:`px-2 py-1 text-xs font-semibold rounded-full ${l(t.currentStock)}`,children:c(t.currentStock)})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Cost/kg"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:r(t.costPerUnit)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Total Value"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:r(a)})]})]}),t.avgSellingPrice!==void 0&&e.jsx("div",{className:"border-t pt-3 mb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Avg. Selling Price"}),t.avgSellingPrice?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:r(t.avgSellingPrice)}),e.jsxs("span",{className:"text-xs text-gray-500",children:["(",t.totalSold," sold)"]})]}):e.jsx("p",{className:"text-sm text-gray-400 italic",children:"No sales yet"})]})}),t.createdAt&&e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-100",children:e.jsxs("p",{className:"text-xs text-gray-400",children:["Added ",O(t.createdAt)]})})]}),t.currentStock<=5&&e.jsx("div",{className:`px-6 py-3 ${t.currentStock===0?"bg-red-50":"bg-yellow-50"}`,children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("svg",{className:`h-4 w-4 mr-2 ${t.currentStock===0?"text-red-400":"text-yellow-400"}`,fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),e.jsx("p",{className:`text-sm font-medium ${t.currentStock===0?"text-red-800":"text-yellow-800"}`,children:t.currentStock===0?"Out of stock - reorder needed":"Low stock - consider reordering"})]})})]})}function de({product:t,onClose:d}){const{containers:u,sales:g}=I(),x=m.useMemo(()=>{if(!t)return[];const r=[];return u.forEach(a=>{if(a.products){const s=a.products.find(p=>p.productId==t.id||p.productId===parseInt(t.id)||p.productId===t.id.toString());s&&r.push({date:a.purchaseDate||a.createdAt,type:"IN",description:`Container Purchase - ${a.id}`,supplier:a.supplier,quantity:s.bagQuantity,costPerKg:s.costPerKg,bagWeight:s.bagWeight||25,reference:a.id})}}),g.forEach(a=>{(a.productId==t.id||a.productId===parseInt(t.id)||a.productId===t.id.toString())&&r.push({date:a.saleDate||a.createdAt,type:"OUT",description:"Product Sale",supplier:a.customerName||"Customer",quantity:-a.quantity,costPerKg:a.pricePerUnit||a.pricePerKg,bagWeight:t.bagWeight||25,reference:a.id})}),r.sort((a,s)=>new Date(s.date)-new Date(a.date))},[t,u,g]),l=r=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(r||0),c=m.useMemo(()=>{let r=0;return x.map(a=>(r+=a.quantity,{...a,balance:r})).reverse()},[x]);return e.jsx(K,{isOpen:!0,onClose:d,size:"xlarge",children:e.jsx("div",{className:"bg-white rounded-lg shadow-xl p-5 max-h-[80vh] overflow-y-auto",children:e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-medium text-gray-900",children:"Product Movement History"}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[t.name," - Current Stock: ",t.currentStock," bags"]})]}),e.jsxs("button",{onClick:d,className:"text-gray-400 hover:text-gray-600 p-2",children:[e.jsx("span",{className:"sr-only",children:"Close"}),e.jsx(U,{className:"h-6 w-6"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsx("div",{className:"bg-green-50 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-8 w-8 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-green-600",children:"Total Purchased"}),e.jsxs("p",{className:"text-2xl font-semibold text-green-900",children:[c.filter(r=>r.quantity>0).reduce((r,a)=>r+a.quantity,0)," bags"]})]})]})}),e.jsx("div",{className:"bg-red-50 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-8 w-8 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 12H4"})})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-red-600",children:"Total Sold"}),e.jsxs("p",{className:"text-2xl font-semibold text-red-900",children:[Math.abs(c.filter(r=>r.quantity<0).reduce((r,a)=>r+a.quantity,0))," bags"]})]})]})}),e.jsx("div",{className:"bg-blue-50 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-8 w-8 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-blue-600",children:"Movements"}),e.jsx("p",{className:"text-2xl font-semibold text-blue-900",children:x.length})]})]})})]}),x.length>0?e.jsx("div",{className:"bg-white shadow overflow-hidden sm:rounded-md",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Type"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Description"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Quantity"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Cost/Kg"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total Value"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Reference"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:x.map((r,a)=>e.jsxs("tr",{className:`hover:bg-gray-50 ${r.type==="OUT"?"bg-red-50":"bg-green-50"}`,children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:O(r.date)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${r.type==="IN"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:r.type})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm text-gray-900",children:r.description}),e.jsx("div",{className:"text-sm text-gray-500",children:r.supplier})]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[r.type==="IN"?"+":"",r.quantity," bags"]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["(",Math.abs(r.quantity)*r.bagWeight,"kg)"]})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:l(r.costPerKg)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:l(Math.abs(r.quantity)*r.bagWeight*r.costPerKg)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-blue-600",children:r.reference})]},a))})]})})}):e.jsxs("div",{className:"text-center py-12 bg-white rounded-lg border",children:[e.jsx("div",{className:"mx-auto h-12 w-12 text-gray-400",children:e.jsx("svg",{fill:"none",stroke:"currentColor",viewBox:"0 0 48 48",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5l7-7 7 7M9 20h6"})})}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No movements found"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"This product has no purchase or sales history yet."})]}),e.jsx("div",{className:"flex justify-end mt-6 pt-6 border-t border-gray-200",children:e.jsx("button",{onClick:d,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Close"})})]})})})}function xe({product:t,onClose:d}){const{destroyProduct:u}=I(),{showSuccessMessage:g,showErrorMessage:x}=B(),[l,c]=m.useState({quantity:"1",reason:"",notes:""}),[r,a]=m.useState({}),[s,p]=m.useState(!1),N=["Damaged during transportation","Water damage","Mold/contamination","Quality issues","Expired/deteriorated","Packaging destroyed","Other"],v=()=>{const i={};return!l.quantity||parseInt(l.quantity)<=0?i.quantity="Quantity must be at least 1":parseInt(l.quantity)>t.currentStock&&(i.quantity=`Cannot destroy more than available stock (${t.currentStock})`),l.reason||(i.reason="Please select a reason"),l.reason==="Other"&&!l.notes.trim()&&(i.notes='Please provide details for "Other" reason'),a(i),Object.keys(i).length===0},j=async i=>{if(i.preventDefault(),!!v()){p(!0);try{const o={productId:t.id,quantity:parseInt(l.quantity),reason:l.reason,notes:l.notes.trim(),date:new Date().toISOString().split("T")[0],time:new Date().toTimeString().split(" ")[0].substring(0,5)};await u(o),g("Product Destroyed",`${l.quantity} ${l.quantity==="1"?"bag":"bags"} of ${t.name} marked as destroyed`),d()}catch(o){console.error("Destroy product error:",o),x("Operation Failed",o.message||"Failed to record destroyed product")}finally{p(!1)}}},b=i=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(i||0),y=parseInt(l.quantity||0)*(t.costPerKg||t.costPerUnit||0)*(t.bagWeight||25);return e.jsx(K,{isOpen:!0,onClose:d,size:"medium",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-gray-200 bg-red-50",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(M,{className:"h-6 w-6 text-red-600 mr-3"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Destroy/Damage Product"}),e.jsx("p",{className:"text-sm text-gray-600 mt-0.5",children:"Record damaged or destroyed inventory"})]})]}),e.jsxs("button",{onClick:d,className:"text-gray-400 hover:text-gray-600 transition-colors",children:[e.jsx("span",{className:"sr-only",children:"Close"}),e.jsx(U,{className:"h-6 w-6"})]})]}),e.jsxs("form",{onSubmit:j,className:"p-6 space-y-4",children:[e.jsx("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Product"}),e.jsx("p",{className:"font-medium text-gray-900",children:t.name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Current Stock"}),e.jsxs("p",{className:"font-medium text-gray-900",children:[t.currentStock," bags"]})]})]})}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"quantity",className:"block text-sm font-medium text-gray-700 mb-1",children:"Quantity to Destroy (bags) *"}),e.jsx("input",{type:"number",id:"quantity",value:l.quantity,onChange:i=>c(o=>({...o,quantity:i.target.value})),min:"1",max:t.currentStock,className:`w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-red-500 ${r.quantity?"border-red-300 focus:border-red-500":"border-gray-300 focus:border-red-500"}`}),r.quantity&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r.quantity}),e.jsxs("p",{className:"mt-1 text-xs text-gray-500",children:["Remaining stock after destruction: ",t.currentStock-(parseInt(l.quantity)||0)," bags"]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"reason",className:"block text-sm font-medium text-gray-700 mb-1",children:"Reason for Destruction *"}),e.jsxs("select",{id:"reason",value:l.reason,onChange:i=>c(o=>({...o,reason:i.target.value})),className:`w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-red-500 ${r.reason?"border-red-300 focus:border-red-500":"border-gray-300 focus:border-red-500"}`,children:[e.jsx("option",{value:"",children:"Select a reason..."}),N.map(i=>e.jsx("option",{value:i,children:i},i))]}),r.reason&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r.reason})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"notes",className:"block text-sm font-medium text-gray-700 mb-1",children:["Additional Details ",l.reason==="Other"&&"*"]}),e.jsx("textarea",{id:"notes",value:l.notes,onChange:i=>c(o=>({...o,notes:i.target.value})),rows:3,className:`w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-red-500 ${r.notes?"border-red-300 focus:border-red-500":"border-gray-300 focus:border-red-500"}`,placeholder:"Provide additional details about the damage or destruction..."}),r.notes&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r.notes})]}),y>0&&e.jsxs("div",{className:"bg-red-50 rounded-lg p-4 border border-red-200",children:[e.jsx("h4",{className:"text-sm font-medium text-red-900 mb-2",children:"Financial Impact"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-red-700",children:"Cost per bag:"}),e.jsx("span",{className:"font-medium text-red-900",children:b((t.costPerKg||t.costPerUnit||0)*(t.bagWeight||25))})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-red-700",children:"Total Loss Value:"}),e.jsx("span",{className:"font-semibold text-red-900",children:b(y)})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:d,disabled:s,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:s,className:"px-4 py-2 text-sm font-medium text-white bg-red-600 border border-transparent rounded-md shadow-sm hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50 disabled:cursor-not-allowed",children:s?"Processing...":"Confirm Destruction"})]})]})]})})}function fe(){const{products:t,containers:d,addProduct:u,updateProduct:g,deleteProduct:x}=I(),[l,c]=m.useState(!1),[r,a]=m.useState(null),[s,p]=m.useState(null),[N,v]=m.useState(null),[j,b]=m.useState("list"),[y,i]=m.useState(""),[o,q]=m.useState(""),[P,T]=m.useState(!1),E=[...new Set(t.map(n=>n.category))].filter(Boolean),w=t.filter(n=>{const h=n.name.toLowerCase().includes(y.toLowerCase())||n.description.toLowerCase().includes(y.toLowerCase()),S=!o||n.category===o,f=!P||n.currentStock<=5;return h&&S&&f}),D=t.length,z=t.reduce((n,h)=>{const S=h.costPerKg||h.costPerUnit||0,f=h.bagWeight||25,J=h.currentStock*f;return n+J*S},0),k=t.filter(n=>n.currentStock<=5).length,H=t.reduce((n,h)=>n+(h.currentStock||0),0),Q=()=>{a(null),c(!0)},$=n=>{a(n),c(!0)},{showConfirmDialog:R}=B(),V=async n=>{const h=t.find(f=>f.id===n);await R("Delete Product",`Are you sure you want to delete "${h?.name}"? This action cannot be undone.`,"danger")&&await x(n)},A=n=>{p(n)},F=n=>{v(n)},X=async n=>{try{r?await g(r.id,n):await u(n),c(!1),a(null)}catch(h){console.error("Form submission error:",h)}},_=()=>{c(!1),a(null)},G=()=>{i(""),q(""),T(!1)};return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"py-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"md:flex md:items-center md:justify-between mb-6",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Products & Inventory"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Manage your product catalog and track inventory levels"})]}),e.jsx("div",{className:"mt-4 md:mt-0 md:ml-4",children:e.jsxs("button",{onClick:Q,className:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),"Add Product"]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8",children:[e.jsx(C,{title:"Total Products",value:`${D}`,subtitle:"Active items in catalog",icon:ne,iconBgColor:"bg-blue-100",iconColor:"text-blue-600"}),e.jsx(C,{title:"Total Value",value:`$${z.toLocaleString()}`,subtitle:"Inventory worth",icon:se,iconBgColor:"bg-green-100",iconColor:"text-green-600"}),e.jsx(C,{title:"Low Stock",value:`${k}`,subtitle:k>0?"Items need restocking":"All items stocked",icon:M,iconBgColor:k>0?"bg-yellow-100":"bg-gray-100",iconColor:k>0?"text-yellow-600":"text-gray-600"}),e.jsx(C,{title:"Bags Available",value:`${H}`,subtitle:"Total bags in stock",icon:L,iconBgColor:"bg-purple-100",iconColor:"text-purple-600"})]}),e.jsx("div",{className:"bg-white shadow rounded-lg mb-6",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"lg:col-span-2",children:[e.jsx("label",{htmlFor:"search",className:"block text-sm font-medium text-gray-700 mb-1",children:"Search Products"}),e.jsx("input",{type:"text",id:"search",value:y,onChange:n=>i(n.target.value),placeholder:"Search by name or description...",className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"category",className:"block text-sm font-medium text-gray-700 mb-1",children:"Category"}),e.jsxs("select",{id:"category",value:o,onChange:n=>q(n.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"All Categories"}),E.map(n=>e.jsx("option",{value:n,children:n},n))]})]}),e.jsx("div",{className:"flex items-end space-x-2",children:e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:P,onChange:n=>T(n.target.checked),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"Low Stock Only"})]})})]}),e.jsxs("div",{className:"flex items-center justify-between mt-4 pt-4 border-t border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("span",{className:"text-sm text-gray-700",children:["Showing ",w.length," of ",D," products"]}),(y||o||P)&&e.jsx("button",{onClick:G,className:"text-sm text-blue-600 hover:text-blue-800",children:"Clear filters"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"View:"}),e.jsxs("div",{className:"flex rounded-md shadow-sm",children:[e.jsx("button",{onClick:()=>b("list"),className:`px-3 py-1 text-sm font-medium rounded-l-md border ${j==="list"?"bg-blue-50 border-blue-200 text-blue-700":"bg-white border-gray-300 text-gray-700 hover:bg-gray-50"}`,children:"List"}),e.jsx("button",{onClick:()=>b("grid"),className:`px-3 py-1 text-sm font-medium rounded-r-md border-l-0 border ${j==="grid"?"bg-blue-50 border-blue-200 text-blue-700":"bg-white border-gray-300 text-gray-700 hover:bg-gray-50"}`,children:"Grid"})]})]})]})]})}),w.length===0?e.jsxs("div",{className:"text-center py-12 bg-white rounded-lg shadow",children:[e.jsx(L,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No products found"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:D===0?"No products added.":"Try adjusting your search or filter criteria."})]}):e.jsx(e.Fragment,{children:j==="list"?e.jsx(ce,{products:w,containers:d,onEdit:$,onDelete:V,onViewMovement:A,onDestroy:F}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:w.map(n=>e.jsx(oe,{product:n,onEdit:$,onDelete:V,onViewMovement:A,onDestroy:F},n.id))})})]})}),l&&e.jsx(ae,{product:r,containers:d,onSubmit:X,onCancel:_}),s&&e.jsx(de,{product:s,onClose:()=>p(null)}),N&&e.jsx(xe,{product:N,onClose:()=>v(null)})]})}export{fe as default};
